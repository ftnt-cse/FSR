{
  "type": "workflow_collections",
  "data": [
    {
      "@context": "/api/3/contexts/WorkflowCollection",
      "@type": "WorkflowCollection",
      "name": "00 - FortiSIEM Integration",
      "description": null,
      "visible": true,
      "image": null,
      "id": 108,
      "createDate": 1594630920,
      "modifyDate": 1594630920,
      "recordTags": [],
      "workflows": [
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "03 - Escalate Alert To Incident - Auto",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/a9b1fbf1-efa1-47dd-8451-e28eb901b88e",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Get Indicator Data",
              "description": null,
              "arguments": {
                "linked_alerts": "[]",
                "indicator_data": "{{(vars.input.records[0]['@id'] + \"?$relationships=true\")|fromIRI}}"
              },
              "status": null,
              "left": "475",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "a58205e8-a07b-4f90-8f02-c13f6ee1c118"
            },
            {
              "@type": "WorkflowStep",
              "name": "Escalate Alert to Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Escalate to Incident </span></p>\n- Escalating the current Alert to incident and linking all related alerts <span style=\"color:orange;font-weight:bold\">{{vars.alerts_iri}}</span>",
                  "records": ""
                },
                "resource": {
                  "name": "{{vars.alert_to_escalate.name+', ID: '+(vars.alert_to_escalate.id|string)  or 'Escalated Incident'}}",
                  "phase": {
                    "id": 136,
                    "@id": "/api/3/picklists/bb740542-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Detection",
                    "@context": "/api/3/contexts/Picklist",
                    "listName": "/api/3/picklist_names/b862eb1f-b385-40ca-baa7-5a1b1f91a651",
                    "itemValue": "Detection",
                    "orderIndex": 0
                  },
                  "users": "{{vars.linked_users_iris}}",
                  "alerts": "{{vars.alerts_iri}}",
                  "assets": "{%if vars.linked_assets_iris|length > 0%}{{vars.linked_assets_iris}}{%endif%}",
                  "owners": "{{vars.alert_to_escalate.owners.0[\"@id\"]}}",
                  "source": "{{vars.alert_to_escalate.source or None}}",
                  "status": {
                    "id": 109,
                    "@id": "/api/3/picklists/bb73fe9e-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Open",
                    "@context": "/api/3/contexts/Picklist",
                    "listName": "/api/3/picklist_names/a549e41c-31ca-406d-89ae-eab3de5c06c4",
                    "itemValue": "Open",
                    "orderIndex": 0
                  },
                  "ackDate": "{{globalVars.Current_Date}}",
                  "metrics": "{{vars.alert_to_escalate.metrics or None}}",
                  "fileName": "{{vars.alert_to_escalate.fileName or None}}",
                  "filehash": "{{vars.alert_to_escalate.fileHash or None}}",
                  "severity": "{{vars.alert_to_escalate.severity or None}}",
                  "sourceIP": "{{vars.alert_to_escalate.sourceIP}}",
                  "sourceId": "{{vars.alert_to_escalate.sourceId}}-{{globalVars.Current_Date}}",
                  "__replace": "",
                  "deviceUID": "{{vars.alert_to_escalate.deviceUID or None}}",
                  "indicators": "{{vars.input.records[0]['@id']}}",
                  "sourcedata": "{{vars.alert_to_escalate.sourcedata or None}}",
                  "description": "{{vars.alert_to_escalate.description or None}}",
                  "processName": "{{vars.alert_to_escalate.processName or None}}",
                  "targetAsset": "{{vars.alert_to_escalate.targetAsset}}",
                  "assigneddate": "{{globalVars.Current_Date}}",
                  "incidentLead": "{{vars.alert_to_escalate.incidentLead or None}}",
                  "senderDomain": "{{vars.alert_to_escalate.domain or None}}",
                  "destinationIP": "{{vars.alert_to_escalate.destinationIp}}",
                  "dateOfIncident": "{{globalVars.Current_Date}}",
                  "confirmationDate": "{{globalVars.Current_Date}}",
                  "senderEmailAddress": "{{vars.alert_to_escalate.senderEmailAddress or None}}",
                  "receipientEmailAddress": "{{alert_to_escalate.recipientEmailAddress or None}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/incidents",
                "tagsOperation": "OverwriteTags",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": {
                  "incident": "{{ vars.result }}"
                }
              },
              "status": null,
              "left": "640",
              "top": "940",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "ba9d83fa-a6ae-47b1-ad81-73fc8f0e5b0a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Escalate Status on Alert",
              "description": null,
              "arguments": {
                "when": "{{vars.alerts_iri | length > 0}}",
                "for_each": {
                  "item": "{{vars.alerts_iri}}",
                  "__bulk": true,
                  "parallel": false,
                  "condition": ""
                },
                "resource": {
                  "escalationReason": "<p><span style=\"color:red;font-weight:bold\">Malicious Indicator Detected !</span></p>",
                  "escalatedtoincident": {
                    "id": 6807,
                    "@id": "/api/3/picklists/fa12313b-66af-4a2e-864e-a5f19241b734",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#bf0a0a",
                    "display": "Yes",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "Yes",
                    "orderIndex": 0
                  }
                },
                "_showJson": false,
                "operation": "Create New",
                "collection": "{{vars.item}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "640",
              "top": "1067",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "aef855a1-e874-46df-87ec-b71a712c19fc"
            },
            {
              "@type": "WorkflowStep",
              "name": "Insert Comment",
              "description": null,
              "arguments": {
                "resource": {
                  "alerts": "{{vars.alerts_iri}}",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Alert has been escalated to an Incident </span></p><span style=\"color:orange;font-weight:bold\">{{vars.steps.Escalate_Alert_to_Incident.id}}</span>",
                  "__replace": ""
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/comments",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "640",
              "top": "1207",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "f16b3f1e-fd70-489d-8226-5a82227a710e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Alerts IRIs",
              "description": null,
              "arguments": {
                "alerts_iri": "{{vars.indicator_data.alerts|json_query('[*][\"@id\"]') | flatten(levels=1)}}"
              },
              "status": null,
              "left": "475",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "37a7ee17-986c-4955-962b-d7c9a6fa5bcf"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Alerts Data",
              "description": null,
              "arguments": {
                "__temp0": "{%for alert in vars.alerts_iri%}\n{{vars.linked_alerts.append((alert+ '?$relationships=true')|fromIRI)}}\n{%endfor%}"
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "0fee7a01-c70f-472d-b931-cff1779dfd67"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Incidents",
              "description": null,
              "arguments": {
                "alert_to_escalate": "{{vars.linked_alerts.0}}",
                "linked_users_iris": "{{(vars.linked_alerts|json_query('[].users[].\\\"@id\\\"'))|unique}}",
                "linked_assets_iris": "{{(vars.linked_alerts|json_query('[].assets[].\\\"@id\\\"'))|unique}}",
                "linked_alerts_incidents": "{{(vars.linked_alerts|json_query('[*].incidents[*][\"@id\"]'))|flatten(levels=2)}}",
                "linked_indicator_incidents": "{{vars.indicator_data.incidents|json_query('[*][\"@id\"]')| flatten(levels=1)}}"
              },
              "status": null,
              "left": "475",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "15ec349d-c29f-401b-905d-fd2e6180ae05"
            },
            {
              "@type": "WorkflowStep",
              "name": "Indicator Linked to Incident",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/bf05996c-aa3e-42ba-9de7-f6186fdc219a",
                    "condition": "{{ vars.linked_indicator_incidents | length > 0 }}",
                    "step_name": "Link Alerts to Indicator Related Incident"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/4f01e5ad-36c3-420e-9921-3c0f04fdaf83",
                    "step_name": "Linked to an Alert Having Incident"
                  }
                ]
              },
              "status": null,
              "left": "475",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "644bc499-2fd2-408b-9e8e-2a3d1c978338"
            },
            {
              "@type": "WorkflowStep",
              "name": "Linked to an Alert Having Incident",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/8fcae4ca-4a38-4032-a8bc-ce6ad1db01b1",
                    "condition": "{{ vars.linked_alerts_incidents | length > 0 }}",
                    "step_name": "Link Alerts to Alert Related Incident"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/ba9d83fa-a6ae-47b1-ad81-73fc8f0e5b0a",
                    "step_name": "Escalate Alert to Incident"
                  }
                ]
              },
              "status": null,
              "left": "640",
              "top": "806",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "4f01e5ad-36c3-420e-9921-3c0f04fdaf83"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Alerts to Indicator Related Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Alerts to Incidents </span></p>\n- Linking Alerts to Incident: <span style=\"color:orange;font-weight:bold\">{{vars.linked_indicator_incidents.0}}</span>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.alerts_iri}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.linked_indicator_incidents.0}}",
                "collectionType": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "320",
              "top": "806",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "bf05996c-aa3e-42ba-9de7-f6186fdc219a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Alerts to Alert Related Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Alerts to Incidents </span></p>\n- At least one alert was escalated, linking all remaining alerts to the same Incident: <span style=\"color:orange;font-weight:bold\">{{vars.linked_alerts_incidents.0}}</span>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.alerts_iri}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.linked_alerts_incidents.0}}",
                "collectionType": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1000",
              "top": "806",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "8fcae4ca-4a38-4032-a8bc-ce6ad1db01b1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "indicators",
                "resources": [
                  "indicators"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "logic": "AND",
                      "filters": [
                        {
                          "type": "object",
                          "field": "typeofindicator",
                          "value": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                          "_value": {
                            "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                            "itemValue": "IP Address"
                          },
                          "operator": "eq"
                        }
                      ]
                    },
                    {
                      "logic": "OR",
                      "filters": [
                        {
                          "type": "object",
                          "field": "reputation",
                          "value": "/api/3/picklists/7074e547-7785-4979-be32-c6d0c863e4bd",
                          "_value": {
                            "@id": "/api/3/picklists/7074e547-7785-4979-be32-c6d0c863e4bd",
                            "itemValue": "Malicious"
                          },
                          "operator": "eq"
                        },
                        {
                          "type": "object",
                          "field": "reputation",
                          "value": "/api/3/picklists/50bfd06c-9aff-4f7d-b6d9-821339e31fe7",
                          "_value": {
                            "@id": "/api/3/picklists/50bfd06c-9aff-4f7d-b6d9-821339e31fe7",
                            "itemValue": "Suspicious"
                          },
                          "operator": "eq"
                        }
                      ]
                    }
                  ]
                }
              },
              "status": null,
              "left": "475",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/9300bf69-5063-486d-b3a6-47eb9da24872",
              "uuid": "a9b1fbf1-efa1-47dd-8451-e28eb901b88e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Assign Investigation and Remediation Task",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Assign Task: Incident Investigation and remediation</span></p>\n",
                  "records": ""
                },
                "resource": {
                  "name": "Assign Investigate and Remediate Incident",
                  "type": {
                    "id": 122,
                    "@id": "/api/3/picklists/826ad76d-e418-4928-9bc9-ea552ebcc5f9",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Incident Response",
                    "listName": "/api/3/picklist_names/b837e375-76af-4ba5-b6a1-bd1c3cd27292",
                    "itemValue": "Incident Response",
                    "orderIndex": 6
                  },
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "alerts": "{{vars.alerts_iri}}",
                  "assets": "{{vars.linked_assets_iris}}",
                  "status": {
                    "id": 169,
                    "@id": "/api/3/picklists/ab65eb0f-e7a7-4993-8474-da5c8b52f380",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Assigned",
                    "listName": "/api/3/picklist_names/21ddbcfd-b4a3-4273-adea-c674fe47d643",
                    "itemValue": "Assigned",
                    "orderIndex": 0
                  },
                  "priority": {
                    "id": 139,
                    "@id": "/api/3/picklists/90088ebe-0a7d-4aa6-9c9c-93b937a4e4f8",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#e36c29",
                    "display": "High",
                    "listName": "/api/3/picklist_names/bea9a490-50d1-4597-8ad9-24422e10676e",
                    "itemValue": "High",
                    "orderIndex": 2
                  },
                  "taskdata": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Task: Incident Investigation and remediation</span></p>\n\n- Indicators are deemed Malicious {%if vars.linked_assets_iris|length > 0%}, Assets <span style=\"color:orange;font-weight:bold\"> {{vars.linked_assets_iris}}</span> are affected {%endif%}\n\n- Run the mitigation playbook to contain the threat\n- Remediate the affected assets",
                  "__replace": "",
                  "incidents": "{{vars.steps.Escalate_Alert_to_Incident['@id']}}",
                  "description": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Assign Task: Incident Investigation and remediation</span></p>\n\n- Indicators are deemed Malicious {%if vars.linked_assets_iris|length > 0%}, Assets <span style=\"color:orange;font-weight:bold\"> {{vars.linked_assets_iris}}</span> are affected {%endif%}\n\n<span style=\"color:red;font-weight:bold\"> Assign this task to an Analyst so they can:</span>\n- Run the mitigation playbook to contain the threat\n- Remediate the affected assets",
                  "assignedOnDate": "{{globalVars.Current_Date}}",
                  "assignedToPerson": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
                  "systemAssignedQueue": "/api/3/system_assigned_queues/43d92df0-3c68-47a0-83dd-85844a620b13"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/tasks",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1000",
              "top": "940",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "d71b813e-40c2-4a58-823b-59e737c31423"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "d28c1465-7b53-4e44-8897-f8a58f534526",
              "name": "Set Escalate Status on Alert -> Insert Comment",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f16b3f1e-fd70-489d-8226-5a82227a710e",
              "sourceStep": "/api/3/workflow_steps/aef855a1-e874-46df-87ec-b71a712c19fc"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4ec4e1a4-a026-4ad2-905d-969ecd3ebd2a",
              "name": "Get Indicator Data -> Get Linked Objects",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/37a7ee17-986c-4955-962b-d7c9a6fa5bcf",
              "sourceStep": "/api/3/workflow_steps/a58205e8-a07b-4f90-8f02-c13f6ee1c118"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "92b9b57d-a349-4c86-9c4e-ccf5f495b889",
              "name": "Get Linked Objects -> Debug",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0fee7a01-c70f-472d-b931-cff1779dfd67",
              "sourceStep": "/api/3/workflow_steps/37a7ee17-986c-4955-962b-d7c9a6fa5bcf"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "08a3ebf8-f9cd-4a8d-a692-e546c581b829",
              "name": "Debug -> Copy  of Debug",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/15ec349d-c29f-401b-905d-fd2e6180ae05",
              "sourceStep": "/api/3/workflow_steps/0fee7a01-c70f-472d-b931-cff1779dfd67"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5008df47-b525-47b5-ab20-5087e4acb140",
              "name": "Copy  of Debug -> Indicator Linked to Incident",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/644bc499-2fd2-408b-9e8e-2a3d1c978338",
              "sourceStep": "/api/3/workflow_steps/15ec349d-c29f-401b-905d-fd2e6180ae05"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0be5f041-e4f9-45f3-b2f1-290b3b74e0e6",
              "name": "Indicator Linked to Incident -> Linked to an Alert Having Incident",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/4f01e5ad-36c3-420e-9921-3c0f04fdaf83",
              "sourceStep": "/api/3/workflow_steps/644bc499-2fd2-408b-9e8e-2a3d1c978338"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ae6df33a-9861-4210-b8c3-26d61d4810c9",
              "name": "Indicator Linked to Incident -> Link Alerts to Indicator Incident",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/bf05996c-aa3e-42ba-9de7-f6186fdc219a",
              "sourceStep": "/api/3/workflow_steps/644bc499-2fd2-408b-9e8e-2a3d1c978338"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "158d7e94-9c1c-4d13-a442-d795dbae98e8",
              "name": "Linked to an Alert Having Incident -> Link Alerts to Alert Related Incident",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8fcae4ca-4a38-4032-a8bc-ce6ad1db01b1",
              "sourceStep": "/api/3/workflow_steps/4f01e5ad-36c3-420e-9921-3c0f04fdaf83"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7ffd4fbd-fbfc-4a28-8d08-89936908d28e",
              "name": "Linked to an Alert Having Incident -> Insert One Incident_Many_to_One",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ba9d83fa-a6ae-47b1-ad81-73fc8f0e5b0a",
              "sourceStep": "/api/3/workflow_steps/4f01e5ad-36c3-420e-9921-3c0f04fdaf83"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0017fa9d-8c5a-4b55-b72d-c1546309d5b3",
              "name": "Escalate Alert to Incident -> Set Escalate Status on Alert",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/aef855a1-e874-46df-87ec-b71a712c19fc",
              "sourceStep": "/api/3/workflow_steps/ba9d83fa-a6ae-47b1-ad81-73fc8f0e5b0a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c9ad5907-0725-4cc2-9df3-780be8f3ef3d",
              "name": "Start -> Get Indicator Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a58205e8-a07b-4f90-8f02-c13f6ee1c118",
              "sourceStep": "/api/3/workflow_steps/a9b1fbf1-efa1-47dd-8451-e28eb901b88e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "28f13041-31f0-44c9-b2e6-9191666f3ceb",
              "name": "Escalate Alert to Incident -> Create Investigation Task",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d71b813e-40c2-4a58-823b-59e737c31423",
              "sourceStep": "/api/3/workflow_steps/ba9d83fa-a6ae-47b1-ad81-73fc8f0e5b0a"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598510478,
          "uuid": "26f24ec1-824d-4396-980f-d5db56cb7fe6",
          "recordTags": [
            "FortiSIEM",
            "Indicator"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "01 - Indicator (Type IP) > Get Reputation",
          "aliasName": null,
          "description": "Get Reputation of IP address",
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": "#Subroutine",
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [
            "indicator_value"
          ],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/3eb9ce0e-9a1e-4cb4-9105-8232f808cefa",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Is Malicious",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "Malicious",
                    "step_iri": "/api/3/workflow_steps/aeecef48-97b8-48d9-a0d1-a2211f8fd64c",
                    "condition": "{{ vars.otx_reputation >= vars.reputation_threshold or vars.vt_reputation >= vars.reputation_threshold or vars.opswat_reputation >= vars.reputation_threshold }}",
                    "step_name": "Set Malicious"
                  },
                  {
                    "option": "No Reputation",
                    "step_iri": "/api/3/workflow_steps/c9e48fe9-3bd4-406f-b0bb-bd7e1636131a",
                    "condition": "{{ vars.otx_reputation == 0 and vars.vt_reputation == 0 and vars.opswat_reputation == 0 }}",
                    "step_name": "Set No Reputation"
                  },
                  {
                    "option": "Safe",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/8bded258-1ca6-401a-ac40-da142c773798",
                    "step_name": "Set Good"
                  },
                  {
                    "option": "Suspicious",
                    "step_iri": "/api/3/workflow_steps/41d24688-c4a2-4591-beb0-ac66ff5753f7",
                    "condition": "{{ (0 < vars.otx_reputation < vars.reputation_threshold) and (0 < vars.vt_reputation < vars.reputation_threshold) and (0 < vars.opswat_reputation < vars.reputation_threshold) }}",
                    "step_name": "Set Suspicious"
                  }
                ]
              },
              "status": null,
              "left": "2533",
              "top": "406",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "c94a4b40-e43d-4cda-aa76-c88f309e974d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Anomali Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.foundAnomaliReputation %}</p>\n<div class=\"card-container-body\" style=\"width: 250px;\">\n<div class=\"card-number\"><a href=\"https://ui.threatstream.com/detail/hash/{{vars.indicator_value}}\" target=\"_blank\" rel=\"noopener noreferrer\"> <span class=\"card-count\">&nbsp;{{vars.steps.Get_Reputation_from_Anomali.data.objects[0].threatscore}}</span> </a>\n<div class=\"font-size-12\">Severity: {{vars.steps.Get_Reputation_from_Anomali.data.objects[0].meta.severity}}</div>\n<div class=\"font-size-14\"><strong>Anomali ThreatStream</strong></div>\n</div>\n</div>\n<p>{% endif %}</p>\n<p>&nbsp;</p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2140",
              "top": "347",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "0a00fac7-0f62-4082-8ec3-f4c2de38a22f"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute AV OTX Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.foundAVReputation %}<br /><span style=\"font-size: 11pt;\"><strong>AlienVault OTX Summary</strong></span></p>\n<table style=\"width: 720px; border-color: #ffffff;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 45px;\"><strong>Tags</strong></td>\n<td style=\"width: 489px;\">{{(vars.steps.Get_AlienVault_Reputation.data.results | json_query(\"[*].tags[]\") | unique | string).replace(\"[\",\"\").replace(\"]\",\"\")}}</td>\n</tr>\n</tbody>\n</table>\n<p>{% endif %}</p>"
                },
                "version": "3.0.1",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2140",
              "top": "187",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "2dec56fa-7b36-41eb-a1bd-8ac059b4ee07"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Whois Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p class=\"p1\">{% if vars.foundWhoIsReputation %}<br /><span style=\"font-size: 11pt;\"><strong>Whois Summary</strong></span></p>\n<table style=\"width: 700px;\" border=\"\\&quot;1\\&quot;\">\n<tbody>\n<tr>\n<td style=\"width: 100px;\"><strong>asn_country_code</strong></td>\n<td style=\"width: 600px;\">{{vars.steps.Whois_IP.data['asn_country_code']}}</td>\n</tr>\n<tr>\n<th style=\"width: 100px;\">entities</th>\n<td style=\"width: 600px;\">{% for value in vars.steps.Whois_IP.data.entities %} {{value}}<br />{%endfor%}</td>\n</tr>\n<tr>\n<th style=\"width: 100px;\">asn</th>\n<td style=\"width: 600px;\">{{vars.steps.Whois_IP.data.asn}}</td>\n</tr>\n<tr>\n<th style=\"width: 100px;\">asn_date</th>\n<td style=\"width: 600px;\">{{vars.steps.Whois_IP.data['asn_date']}}</td>\n</tr>\n<tr>\n<th style=\"width: 100px;\">asn_description</th>\n<td style=\"width: 600px;\">{{vars.steps.Whois_IP.data['asn_description']}}</td>\n</tr>\n<tr>\n<th style=\"width: 100px;\">asn_cidr</th>\n<td style=\"width: 600px;\">{{vars.steps.Whois_IP.data['asn_cidr']}}</td>\n</tr>\n<tr>\n<th style=\"width: 100px;\">objects</th>\n<td style=\"width: 600px;\">roles: {% for value in vars.steps.Whois_IP.data.objects[0].roles %} {{value}}&nbsp;<br />{%endfor%}</td>\n</tr>\n<tr>\n<th style=\"width: 150px;\">entities</th>\n<td style=\"width: 600px;\">{% for value in vars.steps.Whois_IP.data.entities %} {{value}} {%endfor%}</td>\n</tr>\n</tbody>\n</table>\n<p><br />{% endif %}</p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2140",
              "top": "700",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "feabf038-2977-4eaa-afcd-0e65b8fc4f93"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute VT Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<div class=\"card-container-body\" style=\"width: 200px;\">\n<div class=\"card-number\"><a href=\"https://www.virustotal.com/#/ip-address/{{vars.record.value}}\" target=\"_blank\" rel=\"noopener noreferrer\"> <span class=\"card-count\">{{vars.steps.Get_VirusTotal_Reputation.data.aggregate}}</span> </a>\n<div class=\"font-size-12 ng-binding\">Detected URLs: {{vars.steps.Get_VirusTotal_Reputation.data['detected_urls'] | length}}</div>\n<div class=\"font-size-14 ng-binding\"><strong>VirusTotal</strong></div>\n</div>\n</div>\n<p>&nbsp;</p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2140",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "8cd8e1b0-5a0e-470e-98bc-a6f2706aa2c4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Configuration",
              "description": null,
              "arguments": {
                "record": "{{vars.input.params['indicator_value'] | ternary(vars.input.params['indicator_value'],vars.input.records[0].value) }}",
                "googleMapAPIkey": "AIzaSyDy4tlleelMlMRB-HuBbgxeBMrfUJQF2ZE",
                "foundIPMxReputation": "false",
                "reputation_threshold": "2",
                "foundAnomaliReputation": "false",
                "foundIpStackReputation": "false"
              },
              "status": null,
              "left": "1100",
              "top": "400",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Geo Locate IP",
              "description": null,
              "arguments": {
                "name": "IPStack",
                "config": "0022176c-57c0-4120-a8d2-ac03990bc318",
                "params": {
                  "query": "{{vars.record}}",
                  "fields": "",
                  "enable_hostname": false,
                  "enable_security": false
                },
                "version": "1.0.0",
                "connector": "ipstack",
                "operation": "ip_locate",
                "ignore_errors": true,
                "operationTitle": "Geolocate IP",
                "step_variables": {
                  "foundIpStackReputation": "{{ ( vars.result.data and (vars.result.data | length > 0) ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "1460",
              "top": "540",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "582deb1a-cbf6-4272-802f-2ec8275d2a29"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get VirusTotal Reputation",
              "description": null,
              "arguments": {
                "name": "VirusTotal",
                "config": "1ba6a7ef-304a-4f78-855d-70b09bcd0b0a",
                "params": {
                  "ip": "{{vars.record}}"
                },
                "version": "1.0.1",
                "connector": "virustotal",
                "operation": "query_ip",
                "operationTitle": "Get IP Reputation",
                "step_variables": [],
                "operationOutput": {
                  "scans": [],
                  "total": "",
                  "scan_id": "",
                  "resource": "",
                  "aggregate": "",
                  "permalink": "",
                  "positives": "",
                  "scan_date": "",
                  "verbose_msg": ""
                }
              },
              "status": null,
              "left": "1460",
              "top": "28",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "8aab4e24-7610-4a36-bc8f-968cc005c55a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get AlienVault Reputation",
              "description": null,
              "arguments": {
                "name": "AlienVault-OTX",
                "config": "3d96900a-f870-4ac6-94d0-00865dbaf86f",
                "params": {
                  "page": 1,
                  "limit": 5,
                  "user_text": "{{vars.record}}"
                },
                "version": "1.0.0",
                "connector": "alienvault-otx",
                "operation": "search_pulses",
                "ignore_errors": true,
                "operationTitle": "Search Pulses",
                "step_variables": {
                  "foundAVReputation": "{{ ( vars.result.data.results and vars.result.data.results | length > 0 ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "1460",
              "top": "188",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "e78bf525-be40-4f20-8747-4bc1259f0b73"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute IP Stack Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p><span style=\"font-size: 11pt;\"><strong>{% if vars.foundIpStackReputation%}</strong></span></p>\n<p><span style=\"font-size: 11pt;\"><strong>Location&nbsp;Summary:</strong></span></p>\n<table style=\"width: 700px;\" border=\"1px\">\n<tbody>\n<tr style=\"height: 16px;\">\n<td style=\"border: 1px solid white; text-align: left; width: 100px; height: 16px;\"><span style=\"font-size: 10pt;\">Country</span></td>\n<td style=\"border: 1px solid white; text-align: left; width: 600px; height: 16px;\"><span style=\"font-size: 10pt;\">{{vars.steps.Geo_Locate_IP.data[0]['country_name']}}</span></td>\n</tr>\n<tr style=\"height: 16px;\">\n<td style=\"border: 1px solid white; text-align: left; width: 100px; height: 16px;\"><span style=\"font-size: 10pt;\">City</span></td>\n<td style=\"border: 1px solid white; text-align: left; width: 600px; height: 16px;\"><span style=\"font-size: 10pt;\">{{vars.steps.Geo_Locate_IP.data[0].city}}</span></td>\n</tr>\n<tr style=\"height: 16px;\">\n<td style=\"border: 1px solid white; text-align: left; width: 100px; height: 16.9034px;\"><span style=\"font-size: 10pt;\">Latitude</span></td>\n<td style=\"border: 1px solid white; text-align: left; width: 600px; height: 16.9034px;\"><span style=\"font-size: 10pt;\">{{vars.steps.Geo_Locate_IP.data[0].latitude}}</span></td>\n</tr>\n<tr style=\"height: 16px;\">\n<td style=\"border: 1px solid white; text-align: left; width: 100px; height: 16px;\"><span style=\"font-size: 10pt;\">Longitude</span></td>\n<td style=\"border: 1px solid white; text-align: left; width: 600px; height: 16.9034px;\"><span style=\"font-size: 11pt;\">{{vars.steps.Geo_Locate_IP.data[0].longitude}}</span></td>\n</tr>\n</tbody>\n</table>\n<p>&nbsp;</p>\n<p><span style=\"font-size: 11pt;\"><strong>Location Map:</strong></span></p>\n<p><span style=\"font-size: 11pt;\"><strong><img src=\"https://maps.googleapis.com/maps/api/staticmap?key={{vars.googleMapAPIkey}}&amp;center={{vars.steps.Geo_Locate_IP.data[0]['country_name']}}&amp;zoom=12&amp;format=png&amp;maptype=roadmap&amp;style=element:geometry%7Ccolor:0x242f3e&amp;style=element:labels.text.fill%7Ccolor:0x746855&amp;style=element:labels.text.stroke%7Ccolor:0x242f3e&amp;style=feature:administrative.locality%7Celement:labels.text.fill%7Ccolor:0xd59563&amp;style=feature:poi%7Celement:labels.text.fill%7Ccolor:0xd59563&amp;style=feature:poi.park%7Celement:geometry%7Ccolor:0x263c3f&amp;style=feature:poi.park%7Celement:labels.text.fill%7Ccolor:0x6b9a76&amp;style=feature:road%7Celement:geometry%7Ccolor:0x38414e&amp;style=feature:road%7Celement:geometry.stroke%7Ccolor:0x212a37&amp;style=feature:road%7Celement:labels.text.fill%7Ccolor:0x9ca5b3&amp;style=feature:road.highway%7Celement:geometry%7Ccolor:0x746855&amp;style=feature:road.highway%7Celement:geometry.stroke%7Ccolor:0x1f2835&amp;style=feature:road.highway%7Celement:labels.text.fill%7Ccolor:0xf3d19c&amp;style=feature:transit%7Celement:geometry%7Ccolor:0x2f3948&amp;style=feature:transit.station%7Celement:labels.text.fill%7Ccolor:0xd59563&amp;style=feature:water%7Celement:geometry%7Ccolor:0x17263c&amp;style=feature:water%7Celement:labels.text.fill%7Ccolor:0x515c6d&amp;style=feature:water%7Celement:labels.text.stroke%7Ccolor:0x17263c&amp;size=600x300&amp;markers=size:mid%7Ccolor:0xff0000%7Clabel:%7C{{vars.steps.Geo_Locate_IP.data[0]['country_name']}}\" alt=\"\" width=\"700\" height=\"350\" /></strong></span></p>\n<p><span style=\"font-size: 10pt;\"><strong>{% endif %}</strong></span></p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2140",
              "top": "540",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "8ef0b4f5-24d9-4414-878d-dd4283be8f17"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation from Anomali",
              "description": null,
              "arguments": {
                "name": "Anomali ThreatStream",
                "config": "8827ae00-b86a-4ed4-aa2c-deae42b1d993",
                "params": {
                  "value": "{{vars.record}}",
                  "validation": false,
                  "filter_option": "Exact",
                  "record_number": "Fetch All Records"
                },
                "version": "2.0.0",
                "connector": "threatstream",
                "operation": "ip_reputation",
                "ignore_errors": true,
                "operationTitle": "Get IP Reputation",
                "step_variables": {
                  "foundAnomaliReputation": "{{ ( vars.result.data.objects and vars.result.data.objects | length > 0 ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "1460",
              "top": "320",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "32619acc-d745-4037-8d96-909c41509d8a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Whois IP",
              "description": null,
              "arguments": {
                "name": "Whois RDAP",
                "config": "5f97d024-1ef2-4b73-b639-a2ec235f490d",
                "params": {
                  "ip": "{{vars.record}}"
                },
                "version": "1.0.0",
                "connector": "whois-rdap",
                "operation": "whois_ip",
                "ignore_errors": true,
                "operationTitle": "Whois IP",
                "step_variables": {
                  "foundWhoIsReputation": "{{ ( vars.result.data.asn_country_code and vars.result.data.asn_country_code | length > 0 ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "1460",
              "top": "700",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "ed94ed60-02af-416b-938c-fa61baf729d7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation from MxToolbox",
              "description": null,
              "arguments": {
                "name": "MxToolbox",
                "config": "aa41f424-4472-4f04-aeec-0a17d6df45f8",
                "params": {
                  "value": "{{vars.record}}",
                  "object": "blacklist",
                  "api_method": "Lookup"
                },
                "version": "1.0.0",
                "connector": "mxtoolbox",
                "operation": "api_call",
                "ignore_errors": true,
                "operationTitle": "Get MxToolbox Records",
                "step_variables": {
                  "foundIPMxReputation": "{{ ( vars.result.data and (vars.result.data | length > 0) ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "1460",
              "top": "860",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "efb17f41-6e60-4ca1-93ad-694974b22ad2"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute MxToolbox Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.foundIPMxReputation %}</p>\n<div class=\"card-container-body\" style=\"width: 200px;\">\n<div class=\"card-number \" style=\"font-size: 50px; font-weight: normal;\"><span class=\"card-count\">{{vars.steps.Get_Reputation_from_MxToolbox.data.result.MxRep}}</span>\n<div class=\"font-size-12 ng-binding\">{% if vars.steps.Get_Reputation_from_MxToolbox.data.result.MxRep == 100 %}Not blacklisted{%else%}Blacklisted{%endif%}</div>\n<div class=\"font-size-14 ng-binding\"><strong>MxToolbox</strong></div>\n</div>\n</div>\n<p>{% endif %}&nbsp;</p>"
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "ignore_errors": true,
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2140",
              "top": "860",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "b32f5841-943d-4259-ba95-1fc58cac6bda"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Malicious",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"Malicious\"))[\"@id\"]}}",
                "Reputation_Type_Text": "Malicious"
              },
              "status": null,
              "left": "2869",
              "top": "134",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "aeecef48-97b8-48d9-a0d1-a2211f8fd64c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Good",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"Good\"))[\"@id\"]}}",
                "Reputation_Type_Text": "Good"
              },
              "status": null,
              "left": "2869",
              "top": "294",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "8bded258-1ca6-401a-ac40-da142c773798"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set No Reputation",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"No Reputation Available\"))[\"@id\"]}}",
                "Reputation_Type_Text": "No Reputation Available"
              },
              "status": null,
              "left": "2869",
              "top": "614",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "c9e48fe9-3bd4-406f-b0bb-bd7e1636131a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Enrichment Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.steps.Match_IP_in_Internal_Subnets.data['ip_matched'] %}</p>\n<p>{{vars.steps.Compute_Private_IP_Summary.data['formatted_string']}}</p>\n<p>{% else %}</p>\n<p>&nbsp;</p>\n<p>{{vars.steps.Compute_VT_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_AV_OTX_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_Anomali_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_IP_Stack_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_Whois_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_MxToolbox_Summary.data['formatted_string']}}</p>\n<p>{% endif %}</p>"
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "3194",
              "top": "489",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "8cad00a2-f23f-4c41-b538-20f8ece8aecf"
            },
            {
              "@type": "WorkflowStep",
              "name": "Summary",
              "description": null,
              "arguments": {
                "reputation": "{{vars.Reputation_Type_Text}}",
                "reputation_iri": "{{vars.Reputation_Type_IRI}}",
                "enrichment_summary": "{{vars.steps.Enrichment_Summary.data['formatted_string']}}"
              },
              "status": null,
              "left": "3840",
              "top": "409",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "9775affb-1476-453e-8bc7-f5202068550e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Is IP Private",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "Public IP",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
                  },
                  {
                    "option": "Private IP",
                    "step_iri": "/api/3/workflow_steps/5e7371fc-e769-4f6c-93fa-85993577b66e",
                    "condition": "{{ vars.steps.Match_IP_in_Internal_Subnets.data['matched_cidr_ip'] | length > 0 }}"
                  }
                ]
              },
              "status": null,
              "left": "775",
              "top": "715",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "a08b6bfe-40e7-4750-aa74-9dbb05150b69"
            },
            {
              "@type": "WorkflowStep",
              "name": "Match IP in Internal Subnets",
              "description": null,
              "arguments": {
                "params": {
                  "cidr": "['10.0.0.0/8','172.16.0.0/12','192.168.0.0/16']",
                  "ip_address": "{{vars.input.params['indicator_value'] | ternary(vars.input.params['indicator_value'],vars.input.records[0].value) }}"
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "ip_cidr_check",
                "operationTitle": "Utils: Is IP in CIDR",
                "step_variables": []
              },
              "status": null,
              "left": "450",
              "top": "715",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "5a49097f-fe5c-4669-8923-ced3814b7d7b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Suspicious",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"Suspicious\"))[\"@id\"]}}",
                "Reputation_Type_Text": "Suspicious"
              },
              "status": null,
              "left": "2869",
              "top": "774",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "41d24688-c4a2-4591-beb0-ac66ff5753f7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": "Indicator reputation is set as 'TBD' by 'Create and Link Indicator' utility playbook. We can ignore those indicators when triggering this PB",
              "arguments": {
                "resource": "indicators",
                "resources": [
                  "indicators"
                ],
                "step_variables": {
                  "input": {
                    "params": {
                      "indicator_value": "{{ vars.indicator_value }}"
                    },
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "object",
                      "field": "typeofindicator",
                      "value": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                      "_value": {
                        "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                        "itemValue": "IP Address"
                      },
                      "operator": "eq"
                    },
                    {
                      "type": "object",
                      "field": "indicatorStatus",
                      "value": "/api/3/picklists/4218cb58-4de5-4eff-ad08-185d36ef9bab",
                      "_value": {
                        "@id": "/api/3/picklists/4218cb58-4de5-4eff-ad08-185d36ef9bab",
                        "itemValue": "Whitelisted"
                      },
                      "operator": "neq"
                    }
                  ]
                }
              },
              "status": null,
              "left": "125",
              "top": "715",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "3eb9ce0e-9a1e-4cb4-9105-8232f808cefa"
            },
            {
              "@type": "WorkflowStep",
              "name": "Is Referenced",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "Referenced",
                    "step_iri": "/api/3/workflow_steps/9775affb-1476-453e-8bc7-f5202068550e",
                    "condition": "{{ vars.input.params['indicator_value'] | length > 0 }}"
                  },
                  {
                    "option": "Upon Create",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/3a76846b-c7af-49f9-8429-2a3054dda663"
                  }
                ]
              },
              "status": null,
              "left": "3520",
              "top": "489",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "0efb2b4f-6451-4c07-90ec-8b00e1c87576"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Record",
              "description": null,
              "arguments": {
                "resource": {
                  "__link": {
                    "recordTags": "{% if vars.foundAVReputation %}{{(vars.steps.Get_AlienVault_Reputation.data.results | json_query(\"[*].tags[]\") | unique | string).replace(\"[\",\"\").replace(\"]\",\"\").replace(\"?\",\"\").replace(\"\\'\",\"\").replace(\"#\",\"\").replace(\"\\\"\",\"\").replace(\"/\",\"\").replace(\"*\",\"\")}}{%endif%}"
                  },
                  "reputation": "{{vars.Reputation_Type_IRI}}",
                  "description": "<h6><strong>{{vars.steps.Enrichment_Summary.data['formatted_string']}}</strong></h6>\n<h6><strong>{% if \"Malicious\" in vars.result.Reputation_Type_Text %} Seems </strong><span style=\"color: red;\">{{vars.result.Reputation_Type_Text}}</span></h6>\n<h6><strong>{% elif \"Good\" in vars.result.Reputation_Type_Text %} Seems </strong><span style=\"color: green;\">{{vars.result.Reputation_Type_Text}}</span></h6>\n<h6><strong>{% elif \"No Reputation Available\" in vars.result.Reputation_Type_Text %} Seems </strong>{{vars.result.Reputation_Type_Text}}</h6>\n<h6><strong>{%endif%}</strong></h6>",
                  "indicatorStatus": "{%if 'alicious' in vars.Reputation_Type_Text%}{{\"IndicatorStatus\" | picklist(\"Blocked\", \"@id\")}}{%else%}{{\"IndicatorStatus\" | picklist(\"Unblocked\", \"@id\")}}{%endif%}",
                  "typeofindicator": {
                    "id": 77,
                    "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "IP Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "IP Address",
                    "orderIndex": 7
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/indicators",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "3840",
              "top": "569",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "3a76846b-c7af-49f9-8429-2a3054dda663"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Private IP Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<div class=\"card-container-body\" style=\"width: 200px;\">\n<div class=\"card-number\"><span class=\"card-count\">0</span>\n<div class=\"font-size-12 ng-binding\">hostname: not-available</div>\n<div class=\"font-size-14 ng-binding\"><strong>Internal IP</strong></div>\n</div>\n</div>"
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "1720",
              "top": "986",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "5e7371fc-e769-4f6c-93fa-85993577b66e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set No Reputation for Private IP",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"No Reputation Available\"))[\"@id\"]}}",
                "Reputation_Type_Text": "No Reputation Available"
              },
              "status": null,
              "left": "3193",
              "top": "986",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "19e7d27b-3f29-4d8a-965d-c95aa6be2583"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get OPSWAT Reputation",
              "description": null,
              "arguments": {
                "name": "Metadefender Cloud",
                "config": "30287072-ef10-468c-b208-12c79417bb81",
                "params": {
                  "ip_address": "{{vars.record}}"
                },
                "version": "1.1.0",
                "connector": "metadefender",
                "operation": "get_ip_reputation",
                "ignore_errors": true,
                "operationTitle": "Get IP Reputation",
                "step_variables": []
              },
              "status": null,
              "left": "1460",
              "top": "426",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "2cf86fcf-23ed-4ddd-a18f-dfa33264e267"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Results",
              "description": null,
              "arguments": {
                "vt_reputation": "{%if not vars.steps.Get_VirusTotal_Reputation.data.aggregate%}0{%else%}{{vars.steps.Get_VirusTotal_Reputation.data.aggregate}}\n{%endif%}",
                "otx_reputation": "{%if not vars.steps.Get_AlienVault_Reputation.data.count%}0{%else%}{{vars.steps.Get_AlienVault_Reputation.data.count}}{%endif%}",
                "opswat_reputation": "{%if not vars.steps.Get_OPSWAT_Reputation.data['detected_by']%}0{%else%}{{vars.steps.Get_OPSWAT_Reputation.data['detected_by']}}{%endif%}"
              },
              "status": null,
              "left": "1794",
              "top": "427",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Quarantine IP on FortiGate",
              "description": null,
              "arguments": {
                "name": "Fortinet FortiGate",
                "config": "0adebb44-e36c-4901-9c3f-7daf02d26f30",
                "params": {
                  "vdom": "",
                  "method": "Quarantine Based",
                  "ip_addresses": "{{vars.record}}",
                  "time_to_live": "12 Hour"
                },
                "version": "3.0.0",
                "connector": "fortigate-firewall",
                "operation": "block_ip",
                "ignore_errors": true,
                "operationTitle": "Block IP Address",
                "step_variables": []
              },
              "status": null,
              "left": "2868",
              "top": "20",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "e8039877-6e6f-4876-86b8-8602387a8668"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "38b29676-6586-472d-8d88-6f5dc3d61b3f",
              "name": "Compute VT Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d",
              "sourceStep": "/api/3/workflow_steps/8cd8e1b0-5a0e-470e-98bc-a6f2706aa2c4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2df5f160-ba26-4802-9dd7-2ccdf91e3cb3",
              "name": "Compute AV OTX Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d",
              "sourceStep": "/api/3/workflow_steps/2dec56fa-7b36-41eb-a1bd-8ac059b4ee07"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9e285631-1833-440e-a35b-07ad162420a8",
              "name": "Compute Anomali Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d",
              "sourceStep": "/api/3/workflow_steps/0a00fac7-0f62-4082-8ec3-f4c2de38a22f"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "56d9adae-5a77-4cab-b23a-d01c42a6c396",
              "name": "Compute IP Stack Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d",
              "sourceStep": "/api/3/workflow_steps/8ef0b4f5-24d9-4414-878d-dd4283be8f17"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b15c31d3-f049-4dbd-928f-0c8737fa7126",
              "name": "Compute Whois Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d",
              "sourceStep": "/api/3/workflow_steps/feabf038-2977-4eaa-afcd-0e65b8fc4f93"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e301c150-dcc0-4018-8d49-c68fc0c56e77",
              "name": "Compute MxToolbox Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d",
              "sourceStep": "/api/3/workflow_steps/b32f5841-943d-4259-ba95-1fc58cac6bda"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "85024aba-6baa-4afb-abf5-2cb790b26604",
              "name": "Is Malicious -> Malicious IRI",
              "label": "Malicious",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/aeecef48-97b8-48d9-a0d1-a2211f8fd64c",
              "sourceStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2bc86aa5-2eaa-41b6-847e-7551fc8c9a99",
              "name": "Is Malicious -> Good IRI",
              "label": "Safe",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8bded258-1ca6-401a-ac40-da142c773798",
              "sourceStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "41b3fe69-843a-45b2-9a9c-97b6c59e6266",
              "name": "Is Malicious -> No Reputation IRI",
              "label": "No Reputation",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c9e48fe9-3bd4-406f-b0bb-bd7e1636131a",
              "sourceStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "92243199-2ae3-496a-bd25-322cd03c402e",
              "name": "Set Good -> Combined Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8cad00a2-f23f-4c41-b538-20f8ece8aecf",
              "sourceStep": "/api/3/workflow_steps/8bded258-1ca6-401a-ac40-da142c773798"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0a8a3807-dc61-4ec7-9dff-974f0f63960f",
              "name": "Set No Reputation -> Combined Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8cad00a2-f23f-4c41-b538-20f8ece8aecf",
              "sourceStep": "/api/3/workflow_steps/c9e48fe9-3bd4-406f-b0bb-bd7e1636131a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9979208d-cb53-4267-b882-8b96d8345e9d",
              "name": "Check CIDR -> Is IP Private",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a08b6bfe-40e7-4750-aa74-9dbb05150b69",
              "sourceStep": "/api/3/workflow_steps/5a49097f-fe5c-4669-8923-ced3814b7d7b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "808ef34b-d707-493d-b97a-a36bbd85c089",
              "name": "Is IP Private -> Configuration",
              "label": "Public IP",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d",
              "sourceStep": "/api/3/workflow_steps/a08b6bfe-40e7-4750-aa74-9dbb05150b69"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d760bd89-4ea9-4fa7-85f3-f3cde141da9b",
              "name": "Configuration -> Get Reputation from VT",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8aab4e24-7610-4a36-bc8f-968cc005c55a",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9fd7ff99-419f-4ba2-bbfd-1fa5fd17f9f8",
              "name": "Configuration -> Get Reputation from AlienVault OTX",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e78bf525-be40-4f20-8747-4bc1259f0b73",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "33fba8c7-bab1-47e2-8dd7-a2c311989229",
              "name": "Configuration -> Get Reputation from Anomali",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/32619acc-d745-4037-8d96-909c41509d8a",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "66fbb659-fa37-4b8d-8add-b951dde902eb",
              "name": "Configuration -> Geo Locate IP",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/582deb1a-cbf6-4272-802f-2ec8275d2a29",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "56b83fda-022f-42b0-be9f-97d5f546581f",
              "name": "Configuration -> Whois IP",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ed94ed60-02af-416b-938c-fa61baf729d7",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "eaf7f23f-9be1-4fee-97bf-d23aa1f21e85",
              "name": "Configuration -> Get Reputation from MxToolbox",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/efb17f41-6e60-4ca1-93ad-694974b22ad2",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ade7c568-1dd2-40e2-bc82-1fd454c8911c",
              "name": "Is Malicious -> Set Suspicious",
              "label": "Suspicious",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/41d24688-c4a2-4591-beb0-ac66ff5753f7",
              "sourceStep": "/api/3/workflow_steps/c94a4b40-e43d-4cda-aa76-c88f309e974d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1dcc90c7-9eef-4614-ae2a-b9a432158b29",
              "name": "Set Suspicious -> Enrichment Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8cad00a2-f23f-4c41-b538-20f8ece8aecf",
              "sourceStep": "/api/3/workflow_steps/41d24688-c4a2-4591-beb0-ac66ff5753f7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a6208ede-ed93-4b01-a99e-fc8b49d5ec2e",
              "name": "Start -> Match IP in Internal Subnets",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5a49097f-fe5c-4669-8923-ced3814b7d7b",
              "sourceStep": "/api/3/workflow_steps/3eb9ce0e-9a1e-4cb4-9105-8232f808cefa"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "62048194-dc22-44d4-9fd7-3df06b116d91",
              "name": "Enrichment Summary -> Is Upon Create",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0efb2b4f-6451-4c07-90ec-8b00e1c87576",
              "sourceStep": "/api/3/workflow_steps/8cad00a2-f23f-4c41-b538-20f8ece8aecf"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0ad2d564-abb8-4fa3-90d7-114f34c051f6",
              "name": "Is Upon Create -> Summary",
              "label": "Referenced",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9775affb-1476-453e-8bc7-f5202068550e",
              "sourceStep": "/api/3/workflow_steps/0efb2b4f-6451-4c07-90ec-8b00e1c87576"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "771a8c82-4ca8-4b52-b8e5-830c3b0d8cc0",
              "name": "Is Upon Create -> Update Record",
              "label": "Upon Create",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3a76846b-c7af-49f9-8429-2a3054dda663",
              "sourceStep": "/api/3/workflow_steps/0efb2b4f-6451-4c07-90ec-8b00e1c87576"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b6331517-6a31-4c62-8221-09f4bcc33f48",
              "name": "Is IP Private -> Compute Private IP Summary",
              "label": "Private IP",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5e7371fc-e769-4f6c-93fa-85993577b66e",
              "sourceStep": "/api/3/workflow_steps/a08b6bfe-40e7-4750-aa74-9dbb05150b69"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a0e8beec-3331-4b3d-8190-08b1e261397d",
              "name": "Compute Private IP Summary -> Copy  of Set No Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/19e7d27b-3f29-4d8a-965d-c95aa6be2583",
              "sourceStep": "/api/3/workflow_steps/5e7371fc-e769-4f6c-93fa-85993577b66e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8115f40c-366b-4bea-80bb-df466821f018",
              "name": "Set No Reputation for Private IP -> Enrichment Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8cad00a2-f23f-4c41-b538-20f8ece8aecf",
              "sourceStep": "/api/3/workflow_steps/19e7d27b-3f29-4d8a-965d-c95aa6be2583"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b8ee0302-c6e9-47f9-a583-b509352ae6eb",
              "name": "Configuration -> Get Reputation from OPSWAT",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2cf86fcf-23ed-4ddd-a18f-dfa33264e267",
              "sourceStep": "/api/3/workflow_steps/86658cf5-3142-4429-8d50-52bb3e71e40d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d76c4f8e-ba13-4fb8-b208-444f15d3a97d",
              "name": "Get Reputation from Anomali -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/32619acc-d745-4037-8d96-909c41509d8a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0804a536-da02-4026-be12-712f5a9765a4",
              "name": "Get Reputation from AlienVault OTX -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/e78bf525-be40-4f20-8747-4bc1259f0b73"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "698cfdbf-fc5c-4265-b04c-54c2c9641bc2",
              "name": "Get Reputation from VT -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/8aab4e24-7610-4a36-bc8f-968cc005c55a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1b69588e-b6f5-4397-a0a5-1ec9559f968e",
              "name": "Get Reputation from OPSWAT -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/2cf86fcf-23ed-4ddd-a18f-dfa33264e267"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "da2fcc78-a6ed-4a25-8a1e-6278ae5b0f8a",
              "name": "Geo Locate IP -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/582deb1a-cbf6-4272-802f-2ec8275d2a29"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d79ff819-a5da-4ec0-9430-f7d30b4ded96",
              "name": "Whois IP -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/ed94ed60-02af-416b-938c-fa61baf729d7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "676cd776-093a-46e5-8763-663040589df5",
              "name": "Get Reputation from MxToolbox -> Set Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6",
              "sourceStep": "/api/3/workflow_steps/efb17f41-6e60-4ca1-93ad-694974b22ad2"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "12148fcc-496e-421d-acde-aba78e86b5fd",
              "name": "Set Results -> Compute VT Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8cd8e1b0-5a0e-470e-98bc-a6f2706aa2c4",
              "sourceStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "29b61e4f-9aef-4a7f-b2ea-8f096a5e0543",
              "name": "Set Results -> Compute AV OTX Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2dec56fa-7b36-41eb-a1bd-8ac059b4ee07",
              "sourceStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "faa2f637-b7f8-472f-92eb-99b14fc32e39",
              "name": "Set Results -> Compute Anomali Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0a00fac7-0f62-4082-8ec3-f4c2de38a22f",
              "sourceStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "964400c3-97fa-48b1-88a0-ba36ef427bff",
              "name": "Set Results -> Compute IP Stack Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8ef0b4f5-24d9-4414-878d-dd4283be8f17",
              "sourceStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "98fbbd05-a49f-4928-970e-d946ed30a718",
              "name": "Set Results -> Compute Whois Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/feabf038-2977-4eaa-afcd-0e65b8fc4f93",
              "sourceStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "065ddddd-54a6-46ef-90ca-507a98fa38d9",
              "name": "Set Results -> Compute MxToolbox Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b32f5841-943d-4259-ba95-1fc58cac6bda",
              "sourceStep": "/api/3/workflow_steps/ffb92dc4-e3cb-4f52-86cb-4c35a1db58b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "47284b87-c6bf-4fbd-974a-1911db332541",
              "name": "Set Malicious -> Enrichment Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8cad00a2-f23f-4c41-b538-20f8ece8aecf",
              "sourceStep": "/api/3/workflow_steps/aeecef48-97b8-48d9-a0d1-a2211f8fd64c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c64799b3-6378-41c0-9f03-97bcfe6c1103",
              "name": "Set Malicious -> Quarantine IP on FortiGate",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e8039877-6e6f-4876-86b8-8602387a8668",
              "sourceStep": "/api/3/workflow_steps/aeecef48-97b8-48d9-a0d1-a2211f8fd64c"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598465450,
          "uuid": "48488fce-dd51-4796-a9e4-fc4c63877b68",
          "recordTags": [
            "Indicators"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "06 - Create or Link Users",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [
            "username",
            "alert_iri"
          ],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/c0fe6b01-0f0e-4e52-83a1-bfb20ece04e7",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "step_variables": {
                  "input": {
                    "params": {
                      "username": "{{ vars.username }}",
                      "alert_iri": "{{ vars.alert_iri }}",
                      "ip_address": "{{ vars.ip_address }}"
                    }
                  }
                }
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/b348f017-9a94-471f-87f8-ce88b6a7ad62",
              "uuid": "c0fe6b01-0f0e-4e52-83a1-bfb20ece04e7"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Record",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "userName",
                      "value": "{{vars.input.params.username}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ],
                  "__selectFields": [
                    "userName"
                  ]
                },
                "module": "users?$limit=30",
                "checkboxFields": true,
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "db7f43b8-a88c-490b-bf82-9e8cc66c7ae4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Record Exists",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/1e23e237-af53-4ace-ae46-a9ce536751aa",
                    "condition": "{{ vars.steps.Find_Record | length > 0 }}",
                    "step_name": "Link Record"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/6267b819-bb55-48ee-9c04-d599acde1e21",
                    "step_name": "Create Record"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "f8a29914-0f09-4778-9b0b-8e81a0c32a29"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Record",
              "description": null,
              "arguments": {
                "resource": {
                  "alerts": "{{vars.input.params['alert_iri']}}",
                  "userName": "{{vars.input.params.username}}",
                  "__replace": "",
                  "recordTags": [
                    "/api/3/tags/FortiSIEM"
                  ]
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/users",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "6267b819-bb55-48ee-9c04-d599acde1e21"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Record",
              "description": null,
              "arguments": {
                "resource": {
                  "__link": {
                    "users": "{{vars.steps.Find_Record[0]['@id']}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.params['alert_iri']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "1e23e237-af53-4ace-ae46-a9ce536751aa"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "159cf16f-88b5-4801-bf87-628eb433bd55",
              "name": "Start -> Find Record",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/db7f43b8-a88c-490b-bf82-9e8cc66c7ae4",
              "sourceStep": "/api/3/workflow_steps/c0fe6b01-0f0e-4e52-83a1-bfb20ece04e7"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "36c38740-2bdd-4980-b43c-0a9ac13ad87b",
              "name": "Find Record -> Record Exists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f8a29914-0f09-4778-9b0b-8e81a0c32a29",
              "sourceStep": "/api/3/workflow_steps/db7f43b8-a88c-490b-bf82-9e8cc66c7ae4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "30c56b79-800e-4e42-910c-795314a2a31b",
              "name": "Record Exists -> Create Record",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6267b819-bb55-48ee-9c04-d599acde1e21",
              "sourceStep": "/api/3/workflow_steps/f8a29914-0f09-4778-9b0b-8e81a0c32a29"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4b2721ed-d816-4e9a-9987-64faffe4e61f",
              "name": "Record Exists -> Link Record",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/1e23e237-af53-4ace-ae46-a9ce536751aa",
              "sourceStep": "/api/3/workflow_steps/f8a29914-0f09-4778-9b0b-8e81a0c32a29"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598465820,
          "uuid": "5287a071-dd58-46e6-9ab3-5c3a0e6d4b5b",
          "recordTags": [
            "Subroutine",
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "00 - FSM-Mapper-G2",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/6b8266ac-eca5-4b20-b312-9fb6bf0bd149",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "alerts",
                "resources": [
                  "alerts"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "source",
                      "value": "%FortiSIEM%",
                      "operator": "like",
                      "_operator": "like"
                    }
                  ]
                }
              },
              "status": null,
              "left": "475",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "6b8266ac-eca5-4b20-b312-9fb6bf0bd149"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Source Data",
              "description": null,
              "arguments": {
                "source_data": "{%if vars.input.records[0].sourcedata.incident_data.nid%}{{vars.input.records[0].sourcedata.incident_data}}{%else%}{{vars.input.records[0].sourcedata}}{%endif%}",
                "eventSeverity": "{%if (vars.input.records[0].sourcedata|type_debug) == \"str\"%}{{(vars.input.records[0].sourcedata|toDict).attributes.eventSeverity|int}}{%else%}{{vars.input.records[0].sourcedata.incident_data.attributes.eventSeverity|int}}{%endif%}",
                "alert_artifacts": "{{vars.input.records[0].sourcedata| extract_artifacts}}"
              },
              "status": null,
              "left": "475",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "081cdefb-86a3-4171-946a-cde0e43e45e3"
            },
            {
              "@type": "WorkflowStep",
              "name": "Fields Mapping",
              "description": null,
              "arguments": {
                "v_URL": "",
                "v_Email": "",
                "v_Domain": "{{vars.source_data.attributes.domain or None}}",
                "v_Metrics": "{{vars.source_data.attributes.incidentTarget or None}}",
                "v_Service": "{{vars.source_data.attributes.bizService or None}}",
                "v_Ack_Date": "",
                "v_Reporter": "{{vars.source_data.attributes.hostName or vars.source_data.attributes.incidentRptDevName or vars.source_data.attributes.reptDevIpAddr}}",
                "v_Username": "{{vars.source_data.attributes.user or (vars.source_data.attributes.incidentTarget|regex_search(\"(?:user):[A-Za-z_.@]+\")) or None}}",
                "v_severity": "{%if 0 <= vars.eventSeverity <= 1%}{{\"Severity\" | picklist(\"Minimal\", \"@id\")}}{%elif 2 <= vars.eventSeverity <= 3%}{{\"Severity\" | picklist(\"Low\", \"@id\")}}{%elif 4 <= vars.eventSeverity <= 6%}{{\"Severity\" | picklist(\"Medium\", \"@id\")}}{%elif 7 <= vars.eventSeverity <= 8%}{{\"Severity\" | picklist(\"High\", \"@id\")}}{%elif 9 <= vars.eventSeverity <= 10%}{{\"Severity\" | picklist(\"High\", \"@id\")}}{%endif%}",
                "v_File_Hash": "",
                "v_File_Name": "{{vars.source_data.associated_events.0.attributes.fileName}}",
                "v_File_Path": "",
                "v_Source_ID": "{{vars.source_data.incident_data.nid}}",
                "v_Source_IP": "{{vars.source_data.attributes.srcIpAddr or None}}",
                "v_eventName": "{{vars.source_data.attributes.eventName or None}}",
                "v_Device_UID": "",
                "v_Email_Body": "",
                "v_Email_From": "",
                "v_Epoch_Time": "",
                "v_Event_Time": "{{vars.source_data.incident_data.attributes.phRecvTime}}",
                "v_File_Names": "",
                "v_Process_ID": "",
                "v_Description": "{{vars.source_data.attributes.incidentTitle or None}}",
                "v_Return_Path": "",
                "v_Source_Port": "",
                "v_Source_Tool": "",
                "v_Source_Type": "{{vars.source_data.incident_data.attributes.eventType}}",
                "v_incidentSrc": "",
                "v_subcategory": "{{vars.source_data.attributes.phSubIncidentCategory}}",
                "v_Command_Line": "",
                "v_Latest_Login": "",
                "v_Process_GUID": "",
                "v_Process_Name": "",
                "v_Process_Tree": "",
                "v_Registry_Key": "",
                "v_Response_SLA": "",
                "v_Target_Asset": "",
                "v_dlp_dlpextra": "",
                "v_Computer_Name": "{%if vars.incidentCategory =='Change/UserAccount'%}{{vars.origDevName}}{%endif%}",
                "v_Email_Headers": "",
                "v_Email_Subject": "",
                "v_Sender_Domain": "",
                "v_Type_Picklist": "",
                "v_Destination_IP": "{{vars.source_data.attributes.destIpAddr or None}}",
                "v_Scheduled_Task": "",
                "v_Source_Process": "",
                "v_Target_Process": "",
                "v_alert_severity": "{{vars.source_data.attributes.eventSeverityCat}}",
                "v_dlp_filtername": "",
                "v_dlp_filtertype": "",
                "v_incidentTarget": "{%if vars.incidentTarget%}{{vars.incidentTarget | extract_artifacts}}{%endif%}",
                "v_Attachment_Names": "",
                "v_Destination_Port": "{{vars.source_data.associated_events.0.attributes.destIpPort}}",
                "v_HR_Email_Address": "hr@fortielab.com",
                "v_Bytes_Transferred": "",
                "v_Escalation_Reason": "",
                "v_FSR_Email_Address": "fsr@fortielab.com",
                "v_Parent_Process_ID": "",
                "private_ip_addresses": "{{(vars.alert_artifacts.IP|ipv4(\"172.16.0.0/12\")) | union((vars.alert_artifacts.IP|ipv4(\"192.168.0.0/12\")))| union((vars.alert_artifacts.IP|ipv4(\"10.0.0.0/8\")))}}",
                "v_Registry_Key_Value": "",
                "v_Email_Recipients_To": "",
                "v_Parent_Process_Name": "",
                "v_Reporter_Email_Body": "",
                "v_Decoded_Command_Line": "",
                "v_Sender_Email_Address": "",
                "v_Recipient_Email_Address": "",
                "v_Parent_Process_Command_Line": ""
              },
              "status": null,
              "left": "475",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "23ee1f12-d74a-4a9a-9f90-8bd885cdd980"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Alert Attributes",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Initialize Alert Fields</span></p>",
                  "records": ""
                },
                "resource": {
                  "name": "{{vars.input.records[0].name}}",
                  "type": "{{\"AlertType\" | picklist(vars.v_subcategory[8:])}}",
                  "dueBy": "{{globalVars.Tomorrow_Date}}",
                  "state": {
                    "id": 220,
                    "@id": "/api/3/picklists/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "New",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "New",
                    "orderIndex": 0
                  },
                  "domain": "{{vars.v_Domain or None}}",
                  "status": {
                    "id": 118,
                    "@id": "/api/3/picklists/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Open",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Open",
                    "orderIndex": 1
                  },
                  "metrics": "{{vars.source_data.attributes.incidentDetail}}",
                  "reporter": "{{vars.v_Reporter}}",
                  "severity": "{{vars.v_severity}}",
                  "sourceId": "{{vars.v_Source_ID}}",
                  "sourceIp": "{{vars.v_Source_IP}}",
                  "userName": "{%if vars.v_Username and 'user:' in vars.v_Username%}{{vars.v_Username.split(':')[1]}}{%else%}{{vars.v_Username}}{%endif%}",
                  "emailBody": "{{vars.source_data.attributes.incidentSource}}",
                  "recordTags": [],
                  "sourceType": "{{vars.v_Source_Type}}",
                  "sourcedata": "{{vars.source_data|toJSON}}",
                  "description": "<span style=\"color:orange;font-weight:bold\">{{vars.v_Description or vars.v_eventName or None}}</span><br>\n- Alert Type: <span style=\"color:orange;font-weight:bold\">{{vars.v_subcategory[8:]}}</span><br>\n{%if vars.v_Source_IP%}- Source IP:<span style=\"color:orange;font-weight:bold\">{{vars.v_Source_IP}}</span><br>{%endif%}\n{%if vars.v_Destination_IP%}- Destination IP:<span style=\"color:orange;font-weight:bold\">{{vars.v_Destination_IP}}</span><br>{%endif%}\n{%if vars.v_Reporter %}- Reporting Device: <span style=\"color:orange;font-weight:bold\">{{vars.v_Reporter}}</span><br>{%endif%}\n{%if vars.v_Username %}- Username: <span style=\"color:orange;font-weight:bold\">{%if 'user:' in vars.v_Username%}{{vars.v_Username.split(':')[1]}}{%else%}{{vars.v_Username}}{%endif%}</span><br>{%endif%}",
                  "respDueDate": "{{globalVars.Tomorrow_Date}}",
                  "assigneddate": "{{globalVars.Current_Data}}",
                  "emailSubject": "None",
                  "destinationIp": "{{vars.v_Destination_IP}}",
                  "killChainPhase": {
                    "id": 373,
                    "@id": "/api/3/picklists/8dfaa4f1-cd5b-43dc-bc3f-8821261fcb69",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Actions on Objectives",
                    "listName": "/api/3/picklist_names/eddbc863-c725-479a-867f-cec66206a6b4",
                    "itemValue": "Actions on Objectives",
                    "orderIndex": 7
                  },
                  "escalationReason": "{{vars.source_data.attributes.incidentTarget}}",
                  "alertDetectionDate": "{{globalVars.Current_Date}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": {
                  "public_ip_addresses": "{{vars.alert_artifacts.IP | difference(vars.private_ip_addresses)}}"
                }
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "3f053cf8-ef94-4a0f-89e9-dd53bc730b82"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Or Link Assets",
              "description": null,
              "arguments": {
                "when": "{{vars.private_ip_addresses | length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create/Link Assets</span></p>\n\n<p><span style=\"color:orange;font-weight:bold\">{{vars.private_ip_addresses}}</span></p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.private_ip_addresses}}",
                  "condition": ""
                },
                "arguments": {
                  "alert_iri": "{{vars.input.records[0]['@id']}}",
                  "ip_address": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "workflowReference": "/api/3/workflows/e35f1316-a39b-468a-bd12-a5a304119c4b"
              },
              "status": null,
              "left": "125",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
              "uuid": "a3bac31f-363c-482d-a333-74a072310834"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Or Link IP Indicators",
              "description": null,
              "arguments": {
                "when": "{{vars.public_ip_addresses | length > 0}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create/Link Indicator </span></p>\n\n<p><span style=\"color:orange;font-weight:bold\">{{vars.public_ip_addresses}}</span></p>",
                  "records": ""
                },
                "for_each": {
                  "item": "{{vars.public_ip_addresses}}",
                  "condition": ""
                },
                "arguments": {
                  "alert_iri": "{{vars.input.records[0]['@id']}}",
                  "ip_address": "{{vars.item}}"
                },
                "apply_async": false,
                "step_variables": [],
                "workflowReference": "/api/3/workflows/fab56481-9bfd-42ae-9df9-42a012ad8687"
              },
              "status": null,
              "left": "475",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
              "uuid": "3d45304b-d259-48da-bcef-254f5838c8b9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Or Link Users",
              "description": null,
              "arguments": {
                "when": "{{vars.steps.Update_Alert_Attributes.userName}}",
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Create/Link User </span></p>\n\n<p><span style=\"color:orange;font-weight:bold\">{{vars.steps.Update_Alert_Attributes.userName}}</span></p>",
                  "records": ""
                },
                "arguments": {
                  "username": "{{vars.steps.Update_Alert_Attributes.userName}}",
                  "alert_iri": "{{vars.input.records[0]['@id']}}"
                },
                "apply_async": false,
                "step_variables": [],
                "workflowReference": "/api/3/workflows/5287a071-dd58-46e6-9ab3-5c3a0e6d4b5b"
              },
              "status": null,
              "left": "825",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
              "uuid": "764ecfdc-33e5-4595-a5ab-7dbada76ad42"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Alert State",
              "description": null,
              "arguments": {
                "resource": {
                  "state": {
                    "id": 223,
                    "@id": "/api/3/picklists/89dc3716-1818-4286-ab75-0d49714aea0f",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Similar Alerts Correlated",
                    "listName": "/api/3/picklist_names/2f9ed741-25fe-475a-9f12-64336288eebf",
                    "itemValue": "Similar Alerts Correlated",
                    "orderIndex": 3
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "1110",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "885f8e3d-5c97-461b-b400-b01c56ab62ac"
            },
            {
              "@type": "WorkflowStep",
              "name": "Wait for Indicator Reputation",
              "description": null,
              "arguments": {
                "delay": {
                  "days": 0,
                  "hours": 0,
                  "weeks": 0,
                  "minutes": 0,
                  "seconds": 10
                }
              },
              "status": null,
              "left": "300",
              "top": "975",
              "stepType": "/api/3/workflow_step_types/6832e556-b9c7-497a-babe-feda3bd27dbf",
              "uuid": "239ae7a2-c295-44ef-83f8-c16fcc1d5066"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Alert Indicators",
              "description": null,
              "arguments": {
                "extended_alert_data": "{{(vars.input.records[0]['@id'] + \"?$relationships=true\")|fromIRI}}"
              },
              "status": null,
              "left": "475",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "aab91589-4987-4780-a8dc-f73db8a660e1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Alert Has Indicators",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/239ae7a2-c295-44ef-83f8-c16fcc1d5066",
                    "condition": "{{ vars.extended_alert_data.indicators | length > 0 }}",
                    "step_name": "Wait for Indicator Reputation"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/8a3c9392-d21b-42a2-b63c-a70b00d804a9",
                    "step_name": "Do Nothing"
                  }
                ]
              },
              "status": null,
              "left": "475",
              "top": "840",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "f7ed0327-64d2-4af4-ba19-c10e45d239d9"
            },
            {
              "@type": "WorkflowStep",
              "name": "Do Nothing",
              "description": null,
              "arguments": {
                "params": [],
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
              },
              "status": null,
              "left": "650",
              "top": "975",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "8a3c9392-d21b-42a2-b63c-a70b00d804a9"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "b6f0718a-a51e-465a-a507-0762d79d86d4",
              "name": "Set Source Data -> Fields Mapping",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/23ee1f12-d74a-4a9a-9f90-8bd885cdd980",
              "sourceStep": "/api/3/workflow_steps/081cdefb-86a3-4171-946a-cde0e43e45e3"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "22f9d827-c375-4912-b2bf-02f636975a8e",
              "name": "Fields Mapping -> Update Alert Attributes",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3f053cf8-ef94-4a0f-89e9-dd53bc730b82",
              "sourceStep": "/api/3/workflow_steps/23ee1f12-d74a-4a9a-9f90-8bd885cdd980"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4b44975d-42b5-4372-82f4-ce6eb0ef09c4",
              "name": "Start -> Set Source Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/081cdefb-86a3-4171-946a-cde0e43e45e3",
              "sourceStep": "/api/3/workflow_steps/6b8266ac-eca5-4b20-b312-9fb6bf0bd149"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c79e583d-3639-4f04-a317-5dabc0a082cf",
              "name": "Update Alert Attributes -> Create Or Link Assets",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a3bac31f-363c-482d-a333-74a072310834",
              "sourceStep": "/api/3/workflow_steps/3f053cf8-ef94-4a0f-89e9-dd53bc730b82"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f94c0ef6-d72c-4142-b85c-dca82d5a73fd",
              "name": "Update Alert Attributes -> Create Or Link IP Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3d45304b-d259-48da-bcef-254f5838c8b9",
              "sourceStep": "/api/3/workflow_steps/3f053cf8-ef94-4a0f-89e9-dd53bc730b82"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6e154f4f-d509-46e6-8ec4-c1ce9a0f8ee5",
              "name": "Update Alert Attributes -> Create Or Link Users",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/764ecfdc-33e5-4595-a5ab-7dbada76ad42",
              "sourceStep": "/api/3/workflow_steps/3f053cf8-ef94-4a0f-89e9-dd53bc730b82"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "63631731-c1b5-46c6-bfe9-2117a578c983",
              "name": "Wait for Indicator Reputation -> Set Alert State",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/885f8e3d-5c97-461b-b400-b01c56ab62ac",
              "sourceStep": "/api/3/workflow_steps/239ae7a2-c295-44ef-83f8-c16fcc1d5066"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "1a458c2f-b018-46de-8904-6895a126861b",
              "name": "Create Or Link Assets -> Get Alert Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/aab91589-4987-4780-a8dc-f73db8a660e1",
              "sourceStep": "/api/3/workflow_steps/a3bac31f-363c-482d-a333-74a072310834"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "67d9423d-59be-4a0a-85ed-7fd498686d92",
              "name": "Create Or Link IP Indicators -> Get Alert Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/aab91589-4987-4780-a8dc-f73db8a660e1",
              "sourceStep": "/api/3/workflow_steps/3d45304b-d259-48da-bcef-254f5838c8b9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d312fd2f-7a84-4180-81e6-2dae4d81ec89",
              "name": "Create Or Link Users -> Get Alert Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/aab91589-4987-4780-a8dc-f73db8a660e1",
              "sourceStep": "/api/3/workflow_steps/764ecfdc-33e5-4595-a5ab-7dbada76ad42"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "61d42717-a5e7-434c-a12c-832bcc33e581",
              "name": "Get Alert Indicators -> Alert Has Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f7ed0327-64d2-4af4-ba19-c10e45d239d9",
              "sourceStep": "/api/3/workflow_steps/aab91589-4987-4780-a8dc-f73db8a660e1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "16daa8a1-8c4c-4f66-ab6b-5832c33d7cb6",
              "name": "Alert Has Indicators -> Wait for Indicator Reputation",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/239ae7a2-c295-44ef-83f8-c16fcc1d5066",
              "sourceStep": "/api/3/workflow_steps/f7ed0327-64d2-4af4-ba19-c10e45d239d9"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "99799548-e607-470d-a050-9355f4574da2",
              "name": "Alert Has Indicators -> Do Nothing",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8a3c9392-d21b-42a2-b63c-a70b00d804a9",
              "sourceStep": "/api/3/workflow_steps/f7ed0327-64d2-4af4-ba19-c10e45d239d9"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598509559,
          "uuid": "68303a17-52fb-4468-bdbf-1ce0e401487a",
          "recordTags": [
            "Alerts",
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "03 - Escalate Alert To Incident - Manual",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/b2fb9fad-73b3-439a-acbf-aa814bbee33e",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "route": "d9996852-7a0a-4e51-b44c-3119cf59d6af",
                "resources": [
                  "indicators"
                ],
                "inputVariables": [],
                "step_variables": {
                  "input": {
                    "records": "{{vars.input.records}}"
                  }
                },
                "displayConditions": {
                  "indicators": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                  }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
              },
              "status": null,
              "left": "475",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
              "uuid": "b2fb9fad-73b3-439a-acbf-aa814bbee33e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Indicator Data",
              "description": null,
              "arguments": {
                "linked_alerts": "[]",
                "indicator_data": "{{(vars.input.records[0]['@id'] + \"?$relationships=true\")|fromIRI}}"
              },
              "status": null,
              "left": "475",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "d623f152-93fd-47a4-99ce-a59ac5fd23dd"
            },
            {
              "@type": "WorkflowStep",
              "name": "Escalate Alert to Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Escalate to Incident </span></p>\n- Escalating the current Alert to incident and linking all related alerts <span style=\"color:orange;font-weight:bold\">{{vars.alerts_iri}}</span>",
                  "records": ""
                },
                "resource": {
                  "name": "{{vars.alert_to_escalate.name or 'Escalated Incident'}}",
                  "phase": {
                    "id": 136,
                    "@id": "/api/3/picklists/bb740542-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Detection",
                    "@context": "/api/3/contexts/Picklist",
                    "listName": "/api/3/picklist_names/b862eb1f-b385-40ca-baa7-5a1b1f91a651",
                    "itemValue": "Detection",
                    "orderIndex": 0
                  },
                  "users": "{{vars.linked_users_iris}}",
                  "alerts": "{{vars.alerts_iri}}",
                  "assets": "{%if vars.linked_assets_iris|length > 0%}{{vars.linked_assets_iris}}{%endif%}",
                  "owners": "{{vars.alert_to_escalate.owners.0[\"@id\"]}}",
                  "source": "{{vars.alert_to_escalate.source or None}}",
                  "status": {
                    "id": 109,
                    "@id": "/api/3/picklists/bb73fe9e-f699-11e7-8c3f-9a214cf093ae",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Open",
                    "@context": "/api/3/contexts/Picklist",
                    "listName": "/api/3/picklist_names/a549e41c-31ca-406d-89ae-eab3de5c06c4",
                    "itemValue": "Open",
                    "orderIndex": 0
                  },
                  "ackDate": "{{globalVars.Current_Date}}",
                  "metrics": "{{vars.alert_to_escalate.metrics or None}}",
                  "fileName": "{{vars.alert_to_escalate.fileName or None}}",
                  "filehash": "{{vars.alert_to_escalate.fileHash or None}}",
                  "severity": "{{vars.alert_to_escalate.severity or None}}",
                  "sourceIP": "{{vars.alert_to_escalate.sourceIP}}",
                  "sourceId": "{{vars.alert_to_escalate.sourceId}}",
                  "__replace": "",
                  "deviceUID": "{{vars.alert_to_escalate.deviceUID or None}}",
                  "indicators": "{{vars.input.records[0]['@id']}}",
                  "sourcedata": "{{vars.alert_to_escalate.sourcedata or None}}",
                  "description": "{{vars.alert_to_escalate.description or None}}",
                  "processName": "{{vars.alert_to_escalate.processName or None}}",
                  "targetAsset": "{{vars.alert_to_escalate.targetAsset}}",
                  "assigneddate": "{{globalVars.Current_Date}}",
                  "incidentLead": "{{vars.alert_to_escalate.incidentLead or None}}",
                  "senderDomain": "{{vars.alert_to_escalate.domain or None}}",
                  "destinationIP": "{{vars.alert_to_escalate.destinationIp}}",
                  "dateOfIncident": "{{globalVars.Current_Date}}",
                  "confirmationDate": "{{globalVars.Current_Date}}",
                  "senderEmailAddress": "{{vars.alert_to_escalate.senderEmailAddress or None}}",
                  "receipientEmailAddress": "{{alert_to_escalate.recipientEmailAddress or None}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/incidents",
                "tagsOperation": "OverwriteTags",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": {
                  "incident": "{{ vars.result }}"
                }
              },
              "status": null,
              "left": "640",
              "top": "940",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "9b184079-6bc5-4bfb-a18d-3c32a3089d9b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Escalate Status on Alert",
              "description": null,
              "arguments": {
                "when": "{{vars.alerts_iri | length > 0}}",
                "for_each": {
                  "item": "{{vars.alerts_iri}}",
                  "__bulk": true,
                  "parallel": false,
                  "condition": ""
                },
                "resource": {
                  "escalationReason": "<p><span style=\"color:red;font-weight:bold\">Malicious Indicator Detected !</span></p>",
                  "escalatedtoincident": {
                    "id": 6807,
                    "@id": "/api/3/picklists/fa12313b-66af-4a2e-864e-a5f19241b734",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#bf0a0a",
                    "display": "Yes",
                    "listName": "/api/3/picklist_names/e131cc54-9ae4-43c9-b830-af6e331fe024",
                    "itemValue": "Yes",
                    "orderIndex": 0
                  }
                },
                "_showJson": false,
                "operation": "Create New",
                "collection": "{{vars.item}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "640",
              "top": "1067",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "7e899d16-b81d-4351-9001-b0ef8ddd3179"
            },
            {
              "@type": "WorkflowStep",
              "name": "Insert Comment",
              "description": null,
              "arguments": {
                "resource": {
                  "alerts": "{{vars.alerts_iri}}",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Alert has been escalated to an Incident </span></p><span style=\"color:orange;font-weight:bold\">{{vars.steps.Escalate_Alert_to_Incident.id}}</span>",
                  "__replace": ""
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/comments",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "640",
              "top": "1207",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "0e64f791-71fd-4d50-82a6-7d803d9471cf"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Alerts IRIs",
              "description": null,
              "arguments": {
                "alerts_iri": "{{vars.indicator_data.alerts|json_query('[*][\"@id\"]') | flatten(levels=1)}}"
              },
              "status": null,
              "left": "475",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "775d18f3-c4e0-425e-8783-990e3995bbcd"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Alerts Data",
              "description": null,
              "arguments": {
                "__temp0": "{%for alert in vars.alerts_iri%}\n{{vars.linked_alerts.append((alert+ '?$relationships=true')|fromIRI)}}\n{%endfor%}"
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "265f2306-67a2-4565-b145-49dabb281ee1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Incidents",
              "description": null,
              "arguments": {
                "alert_to_escalate": "{{vars.linked_alerts.0}}",
                "linked_users_iris": "{{(vars.linked_alerts|json_query('[].users[].\\\"@id\\\"'))|unique}}",
                "linked_assets_iris": "{{(vars.linked_alerts|json_query('[].assets[].\\\"@id\\\"'))|unique}}",
                "linked_alerts_incidents": "{{(vars.linked_alerts|json_query('[*].incidents[*][\"@id\"]'))|flatten(levels=2)}}",
                "linked_indicator_incidents": "{{vars.indicator_data.incidents|json_query('[*][\"@id\"]')| flatten(levels=1)}}"
              },
              "status": null,
              "left": "475",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "739c61f2-b4da-4c77-bcff-293be1c6e33c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Indicator Linked to Incident",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/cc8c1f26-ff23-4bd7-8fe2-ff9941cd15ef",
                    "condition": "{{ vars.linked_indicator_incidents | length > 0 }}",
                    "step_name": "Link Alerts to Indicator Related Incident"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/8550e3c2-73df-436d-ace1-4579b43cc74e",
                    "step_name": "Linked to an Alert Having Incident"
                  }
                ]
              },
              "status": null,
              "left": "475",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "b79f27ff-5e6b-4f94-b8df-eff7028f09e2"
            },
            {
              "@type": "WorkflowStep",
              "name": "Linked to an Alert Having Incident",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/deb499ae-811a-4039-8e42-1db0f76616f5",
                    "condition": "{{ vars.linked_alerts_incidents | length > 0 }}",
                    "step_name": "Link Alerts to Alert Related Incident"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/9b184079-6bc5-4bfb-a18d-3c32a3089d9b",
                    "step_name": "Escalate Alert to Incident"
                  }
                ]
              },
              "status": null,
              "left": "640",
              "top": "806",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "8550e3c2-73df-436d-ace1-4579b43cc74e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Alerts to Indicator Related Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Alerts to Incidents </span></p>\n- Linking Alerts to Incident: <span style=\"color:orange;font-weight:bold\">{{vars.linked_indicator_incidents.0}}</span>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.alerts_iri}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.linked_indicator_incidents.0}}",
                "collectionType": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "320",
              "top": "806",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "cc8c1f26-ff23-4bd7-8fe2-ff9941cd15ef"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Alerts to Alert Related Incident",
              "description": null,
              "arguments": {
                "message": {
                  "tags": [],
                  "type": "/api/3/picklists/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                  "tenant": "",
                  "content": "<p><span style=\"background-color:yellow;color:black;font-weight:bold\">Link Alerts to Incidents </span></p>\n- At least one alert was escalated, linking all remaining alerts to the same Incident: <span style=\"color:orange;font-weight:bold\">{{vars.linked_alerts_incidents.0}}</span>",
                  "records": ""
                },
                "resource": {
                  "__link": {
                    "alerts": "{{vars.alerts_iri}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.linked_alerts_incidents.0}}",
                "collectionType": "/api/3/incidents",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "1000",
              "top": "806",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "deb499ae-811a-4039-8e42-1db0f76616f5"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "f3c53380-a786-4549-bb3e-8a9469dee7e8",
              "name": "Start -> Get Related Objects",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d623f152-93fd-47a4-99ce-a59ac5fd23dd",
              "sourceStep": "/api/3/workflow_steps/b2fb9fad-73b3-439a-acbf-aa814bbee33e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "85d2e992-9c6f-4176-aaf5-e7711ea1ef88",
              "name": "Set Escalate Status on Alert -> Insert Comment",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/0e64f791-71fd-4d50-82a6-7d803d9471cf",
              "sourceStep": "/api/3/workflow_steps/7e899d16-b81d-4351-9001-b0ef8ddd3179"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "26fa88ea-85d3-4da1-ba83-8ab65a1548ba",
              "name": "Get Indicator Data -> Get Linked Objects",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/775d18f3-c4e0-425e-8783-990e3995bbcd",
              "sourceStep": "/api/3/workflow_steps/d623f152-93fd-47a4-99ce-a59ac5fd23dd"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "ee5aee65-ec6c-45b0-9aa0-76f8de8ff8a7",
              "name": "Get Linked Objects -> Debug",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/265f2306-67a2-4565-b145-49dabb281ee1",
              "sourceStep": "/api/3/workflow_steps/775d18f3-c4e0-425e-8783-990e3995bbcd"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0953627c-fbfb-4f17-8976-616f93f5a9b2",
              "name": "Debug -> Copy  of Debug",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/739c61f2-b4da-4c77-bcff-293be1c6e33c",
              "sourceStep": "/api/3/workflow_steps/265f2306-67a2-4565-b145-49dabb281ee1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a903f6c0-df37-48d2-bf1e-8f4d17b99f14",
              "name": "Copy  of Debug -> Indicator Linked to Incident",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/b79f27ff-5e6b-4f94-b8df-eff7028f09e2",
              "sourceStep": "/api/3/workflow_steps/739c61f2-b4da-4c77-bcff-293be1c6e33c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d622e748-82e9-434c-a6f4-8417033a005a",
              "name": "Indicator Linked to Incident -> Linked to an Alert Having Incident",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8550e3c2-73df-436d-ace1-4579b43cc74e",
              "sourceStep": "/api/3/workflow_steps/b79f27ff-5e6b-4f94-b8df-eff7028f09e2"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "07caa5e6-6bf9-4899-901f-48b7c0d49f4e",
              "name": "Indicator Linked to Incident -> Link Alerts to Indicator Incident",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/cc8c1f26-ff23-4bd7-8fe2-ff9941cd15ef",
              "sourceStep": "/api/3/workflow_steps/b79f27ff-5e6b-4f94-b8df-eff7028f09e2"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "870e7a53-e08d-46cb-90c8-b8f089ea8c7e",
              "name": "Linked to an Alert Having Incident -> Link Alerts to Alert Related Incident",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/deb499ae-811a-4039-8e42-1db0f76616f5",
              "sourceStep": "/api/3/workflow_steps/8550e3c2-73df-436d-ace1-4579b43cc74e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f17e7b9a-fb11-4cc1-9ca8-dd159cb3931a",
              "name": "Linked to an Alert Having Incident -> Insert One Incident_Many_to_One",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9b184079-6bc5-4bfb-a18d-3c32a3089d9b",
              "sourceStep": "/api/3/workflow_steps/8550e3c2-73df-436d-ace1-4579b43cc74e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "20b0540b-ce46-4779-854a-f5304bbfbeef",
              "name": "Escalate Alert to Incident -> Set Escalate Status on Alert",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7e899d16-b81d-4351-9001-b0ef8ddd3179",
              "sourceStep": "/api/3/workflow_steps/9b184079-6bc5-4bfb-a18d-3c32a3089d9b"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598463574,
          "uuid": "6fdbde5f-c077-4b55-915a-d4b6799608cb",
          "recordTags": [
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "02 - Indicator (Type URL) > Set Reputation and Block",
          "aliasName": null,
          "description": "Set Reputation of URL",
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": "#Subroutine",
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [
            "indicator_value"
          ],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/7617f1b8-30a8-4ea7-a5a5-d2add2ca2a63",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation from AlienVault OTX",
              "description": null,
              "arguments": {
                "name": "AlienVault-OTX",
                "config": "3d96900a-f870-4ac6-94d0-00865dbaf86f",
                "params": {
                  "url": "{{vars.indicator_value}}"
                },
                "version": "1.0.0",
                "connector": "alienvault-otx",
                "operation": "get_url_reputation",
                "ignore_errors": true,
                "operationTitle": "Get URL Reputation",
                "step_variables": []
              },
              "status": null,
              "left": "370",
              "top": "380",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "ac9b0a48-4ccc-461d-adaf-9c83504064b6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute Anomali Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.foundAnomaliReputation %}</p>\n<div class=\"card-container-body\" style=\"width: 250px;\">\n<div class=\"card-number\"><a href=\"https://ui.threatstream.com/detail/hash/{{vars.indicator_value}}\" target=\"_blank\" rel=\"noopener noreferrer\"> <span class=\"card-count\">{{vars.steps.Get_URL_Reputation_from_Anomali.data.objects[0].threatscore}} </span> </a>\n<div class=\"font-size-12\">Severity: {{vars.steps.Get_URL_Reputation_from_Anomali.data.objects[0].meta.severity}}</div>\n<div class=\"font-size-14\"><strong>Anomali ThreatStream</strong></div>\n</div>\n</div>\n<p>{% endif %}</p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "1060",
              "top": "160",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "79c84609-d231-4156-8922-897b7aad3e90"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute URLVoid Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.foundURLvoidReputation %}</p>\n<div class=\"card-container-body\" style=\"width: 200px;\">\n<div class=\"card-number\"><a href=\"https://www.urlvoid.com/scan/{{vars.indicator_value.split('/')[-1]}}\" target=\"&quot;_blank&quot;&quot;\"> <span class=\"card-count\">{%if 'detections' in vars.steps.Get_Reputation_from_URLVoid.data %} {{vars.steps.Get_Reputation_from_URLVoid.data.detections.count}}{%else%} 0 {%endif%}</span> </a>\n<div class=\"font-size-12 ng-binding\">IP Address: {{vars.steps.Get_Reputation_from_URLVoid.data.details.ip.addr}}</div>\n<div class=\"font-size-14 ng-binding\"><strong>URLVoid</strong></div>\n</div>\n</div>\n<p>{% endif %}</p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "1060",
              "top": "500",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "4bc0f3cd-dd91-43b2-a63b-8aec1d3a8450"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute AV OTX Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{% if vars.foundAVReputation %}</p>\n<p><span style=\"font-size: 14pt;\"><strong>AlienVault OTX Summary</strong></span></p>\n<table style=\"width: 720px; border-color: #ffffff;\" border=\"1\">\n<tbody>\n<tr>\n<td style=\"width: 40px;\"><strong>Tags</strong></td>\n<td style=\"width: 489px;\">{{(vars.steps.Get_Reputation_from_AlienVault_OTX.data.results | json_query(\"[*].tags[]\") | unique | string).replace(\"[\",\"\").replace(\"]\",\"\")}}</td>\n</tr>\n</tbody>\n</table>\n<p>{% endif %}</p>"
                },
                "version": "3.0.1",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "1060",
              "top": "387",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "e7f804c8-5168-4fb1-a396-2a28ba7432c4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Is Malicious",
              "description": "Is Malicious",
              "arguments": {
                "conditions": [
                  {
                    "option": "is Malicious",
                    "step_iri": "/api/3/workflow_steps/e4b58964-162d-4c5e-802c-1d1a32b0855d",
                    "condition": "{{ vars.vt_reputation >= vars.reputation_threshold or vars.phishtank_reputation >= vars.reputation_threshold or vars.alienvault_reputation >= vars.reputation_threshold or vars.fortiguard_reputation >= vars.reputation_threshold }}",
                    "step_name": "Set Malicious"
                  },
                  {
                    "option": "is good",
                    "step_iri": "/api/3/workflow_steps/6a1960f2-bbed-4871-a05a-1ed323c13d33",
                    "condition": "{{ vars.vt_reputation == 0 and vars.phishtank_reputation == 0 and vars.alienvault_reputation == 0 and vars.fortiguard_reputation == 0 }}",
                    "step_name": "Set Good"
                  },
                  {
                    "option": "no reputation",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/837c26a2-420a-4cb0-9ffd-a18276fdbc89",
                    "step_name": "Set No reputation"
                  }
                ]
              },
              "status": null,
              "left": "1434",
              "top": "320",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "9a6f6f21-92d8-4aac-83c2-4caf5e50442c"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute VT Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<div class=\"card-container-body\" style=\"width: 200px;\">\n<div class=\"card-number\"><a href=\"{{vars.steps.Get_URL_Reputation_from_VT.data.permalink}}\" target=\"_blank\" rel=\"noopener noreferrer\"> <span class=\"card-count\">{{vars.steps.Get_URL_Reputation_from_VT.data.aggregate}}</span> </a>\n<div class=\"font-size-12 ng-binding\">Detection Ratio: {{vars.steps.Get_URL_Reputation_from_VT.data.positives}}/{{vars.steps.Get_URL_Reputation_from_VT.data.total}}</div>\n<div class=\"font-size-14 ng-binding\"><strong>VirusTotal</strong></div>\n</div>\n</div>"
                },
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": {
                  "VT_positives": "{{vars.steps.Get_URL_Reputation_from_VT.data.positives}}"
                }
              },
              "status": null,
              "left": "1060",
              "top": "40",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "00846d83-4a15-4b0a-bc0e-bdd76059056d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get URL Reputation from Anomali",
              "description": null,
              "arguments": {
                "name": "Anomali ThreatStream",
                "config": "8827ae00-b86a-4ed4-aa2c-deae42b1d993",
                "params": {
                  "value": "{{vars.indicator_value}}",
                  "validation": false,
                  "filter_option": "Exact",
                  "record_number": "Fetch All Records"
                },
                "version": "2.0.0",
                "connector": "threatstream",
                "operation": "url_reputation",
                "ignore_errors": true,
                "operationTitle": "Get URL Reputation",
                "step_variables": {
                  "foundAnomaliReputation": "{{ ( vars.result.data.objects and vars.result.data.objects | length > 0 ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "368",
              "top": "160",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "6bb0a28c-1166-40e8-877c-b8078413972d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation from URLVoid",
              "description": null,
              "arguments": {
                "name": "URLVoid",
                "config": "80158417-6916-4f4f-b979-fc84ea02e2be",
                "params": {
                  "domain": "{{vars.indicator_value}}",
                  "rescan": true
                },
                "version": "1.1.0",
                "connector": "urlvoid",
                "operation": "domain_reputation",
                "ignore_errors": true,
                "operationTitle": "Get Website Reputation ",
                "step_variables": {
                  "foundURLvoidReputation": "{{ ( vars.result.data and vars.result.data | length > 0 ) | ternary(true,false) }}"
                }
              },
              "status": null,
              "left": "368",
              "top": "500",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "dc6997c4-de74-4086-90d9-9eca21fb53dd"
            },
            {
              "@type": "WorkflowStep",
              "name": "Configuration",
              "description": null,
              "arguments": {
                "indicator_value": "{{vars.input.params['indicator_value'] | ternary(vars.input.params['indicator_value'],vars.input.records[0].value) }}",
                "reputation_threshold": "2",
                "foundAnomaliReputation": "false"
              },
              "status": null,
              "left": "12",
              "top": "320",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get URL Reputation from VT",
              "description": null,
              "arguments": {
                "name": "VirusTotal",
                "config": "1ba6a7ef-304a-4f78-855d-70b09bcd0b0a",
                "params": {
                  "url": "{{vars.indicator_value}}"
                },
                "version": "1.0.1",
                "connector": "virustotal",
                "operation": "query_url",
                "operationTitle": "Get URL Reputation",
                "step_variables": [],
                "operationOutput": {
                  "scans": [],
                  "total": "",
                  "scan_id": "",
                  "resource": "",
                  "aggregate": "",
                  "permalink": "",
                  "positives": "",
                  "scan_date": "",
                  "verbose_msg": ""
                }
              },
              "status": null,
              "left": "368",
              "top": "40",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "a94eb30f-abaf-4a02-acd7-2cbb1f21c0b1"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Malicious",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"Malicious\"))[\"@id\"]}}",
                "Reputation_Type_Text": "Malicious"
              },
              "status": null,
              "left": "1808",
              "top": "200",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "e4b58964-162d-4c5e-802c-1d1a32b0855d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set Good",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"Good\"))[\"@id\"]}}",
                "Reputation_Type_Text": "Good"
              },
              "status": null,
              "left": "1793",
              "top": "320",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "6a1960f2-bbed-4871-a05a-1ed323c13d33"
            },
            {
              "@type": "WorkflowStep",
              "name": "Set No reputation",
              "description": null,
              "arguments": {
                "Reputation_Type_IRI": "{{(\"IndicatorReputation\" | picklist(\"No Reputation Available\"))[\"@id\"]}}",
                "Reputation_Type_Text": "No Reputation Available"
              },
              "status": null,
              "left": "1805",
              "top": "460",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "837c26a2-420a-4cb0-9ffd-a18276fdbc89"
            },
            {
              "@type": "WorkflowStep",
              "name": "Enrichment Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<p>{{vars.steps.Compute_VT_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_URLVoid_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_AV_OTX_Summary.data['formatted_string']}}</p>\n<p>{{vars.steps.Compute_Anomali_Summary.data['formatted_string']}}</p>"
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": []
              },
              "status": null,
              "left": "2200",
              "top": "320",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "1e358a84-241f-4d9f-a2c2-a96a2b380ae3"
            },
            {
              "@type": "WorkflowStep",
              "name": "Summary",
              "description": null,
              "arguments": {
                "reputation": "{{vars.Reputation_Type_Text}}",
                "reputation_iri": "{{vars.Reputation_Type_IRI}}",
                "enrichment_summary": "{{vars.steps.Enrichment_Summary.data['formatted_string']}}"
              },
              "status": null,
              "left": "2800",
              "top": "440",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "baca38d4-5695-449c-988a-ee043fffa907"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": "Indicator reputation is set as 'TBD' by 'Create and Link Indicator' utility playbook. We can ignore those indicators when triggering this PB",
              "arguments": {
                "resource": "indicators",
                "resources": [
                  "indicators"
                ],
                "step_variables": {
                  "input": {
                    "params": {
                      "indicator_value": "{{ vars.indicator_value }}"
                    },
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "object",
                      "field": "typeofindicator",
                      "value": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                      "_value": {
                        "@id": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                        "itemValue": "URL"
                      },
                      "operator": "eq"
                    },
                    {
                      "type": "object",
                      "field": "indicatorStatus",
                      "value": "/api/3/picklists/4218cb58-4de5-4eff-ad08-185d36ef9bab",
                      "_value": {
                        "@id": "/api/3/picklists/4218cb58-4de5-4eff-ad08-185d36ef9bab",
                        "itemValue": "Whitelisted"
                      },
                      "operator": "neq"
                    }
                  ]
                }
              },
              "status": null,
              "left": "12",
              "top": "49",
              "stepType": "/api/3/workflow_step_types/ea155646-3821-4542-9702-b246da430a8d",
              "uuid": "7617f1b8-30a8-4ea7-a5a5-d2add2ca2a63"
            },
            {
              "@type": "WorkflowStep",
              "name": "Is Upon Create",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "Referenced",
                    "step_iri": "/api/3/workflow_steps/baca38d4-5695-449c-988a-ee043fffa907",
                    "condition": "{{ vars.input.params['indicator_value'] | length > 0 }}"
                  },
                  {
                    "option": "Upon Create",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/dfb9a8ab-7184-4b96-b1d8-fa24ba0840ef"
                  }
                ]
              },
              "status": null,
              "left": "2500",
              "top": "320",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "60f261fe-2b3a-4588-9326-165fa6c1ba04"
            },
            {
              "@type": "WorkflowStep",
              "name": "Update Record",
              "description": null,
              "arguments": {
                "resource": {
                  "__link": {
                    "recordTags": "{% if vars.foundAVReputation %}{{(vars.steps.Get_Reputation_from_AlienVault_OTX.data.results | json_query(\"[*].tags[]\") | unique | string).replace(\"[\",\"\").replace(\"]\",\"\").replace(\"?\",\"\").replace(\"\\'\",\"\").replace(\"#\",\"\").replace(\"\\\"\",\"\").replace(\"/\",\"\").replace(\"*\",\"\")}}{%endif%}"
                  },
                  "firstSeen": "{{globalVars.Current_Date}}",
                  "reputation": "{{vars.Reputation_Type_IRI}}",
                  "description": "<h6><strong>{{vars.steps.Enrichment_Summary.data['formatted_string']}}</strong></h6>\n<h6><strong>{% if \"Malicious\" in vars.result.Reputation_Type_Text %} Seems </strong><span style=\"color: red;\">{{vars.result.Reputation_Type_Text}}</span></h6>\n<h6><strong>{% elif \"Good\" in vars.result.Reputation_Type_Text %} Seems </strong><span style=\"color: green;\">{{vars.result.Reputation_Type_Text}}</span></h6>\n<h6><strong>{% elif \"No Reputation Available\" in vars.result.Reputation_Type_Text %} Seems </strong>{{vars.result.Reputation_Type_Text}}</h6>\n<h6><strong>{%endif%}</strong></h6>",
                  "indicatorStatus": "{%if 'alicious' in vars.Reputation_Type_Text%}{{\"IndicatorStatus\" | picklist(\"Blocked\", \"@id\")}}{%else%}{{\"IndicatorStatus\" | picklist(\"Unblocked\", \"@id\")}}{%endif%}",
                  "typeofindicator": {
                    "id": 80,
                    "@id": "/api/3/picklists/353a37b4-3eeb-43ee-aac6-64806422cfec",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "URL",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "URL",
                    "orderIndex": 10
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/indicators",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "2833",
              "top": "200",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "dfb9a8ab-7184-4b96-b1d8-fa24ba0840ef"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get URL Reputation FortiGuard",
              "description": null,
              "arguments": {
                "name": "Fortinet Web Filter Lookup",
                "config": "fc389c32-6ffb-49b8-a942-369f00e3ef93",
                "params": {
                  "sample_url": "{{vars.indicator_value}}"
                },
                "version": "1.0.0",
                "connector": "fortinet-web-filter-lookup",
                "operation": "url_review",
                "operationTitle": "Check Category of Domain or URL",
                "step_variables": []
              },
              "status": null,
              "left": "369",
              "top": "260",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "70d9f873-e4c7-4d6e-82c7-65fc5133933a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compute FortiGuard Summary",
              "description": null,
              "arguments": {
                "params": {
                  "value": "<div class=\"card-container-body\" style=\"width: 200px;\">\n<div class=\"card-number\"><a href=\"{{vars.steps.Get_URL_Reputation_from_VT.data.permalink}}\" target=\"_blank\" rel=\"noopener noreferrer\"> <span class=\"card-count\">{{vars.steps.Get_URL_Reputation_from_VT.data.aggregate}}</span> </a>\n<div class=\"font-size-12 ng-binding\">Detection Ratio: {{vars.steps.Get_URL_Reputation_from_VT.data.positives}}/{{vars.steps.Get_URL_Reputation_from_VT.data.total}}</div>\n<div class=\"font-size-14 ng-binding\"><strong>VirusTotal</strong></div>\n</div>\n</div>"
                },
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "format_richtext",
                "operationTitle": "Utils: Format as RichText",
                "step_variables": {
                  "FG_Category": "{{vars.steps.Get_URL_Reputation_FortiGuard.data.category}}"
                }
              },
              "status": null,
              "left": "1060",
              "top": "260",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "8825eb02-1a5f-46b5-b3c7-a60e77186987"
            },
            {
              "@type": "WorkflowStep",
              "name": "Aggregate Results",
              "description": null,
              "arguments": {
                "vt_reputation": "{%if not vars.steps.Get_URL_Reputation_from_VT.data.aggregate%}0{%else%}{{vars.steps.Get_URL_Reputation_from_VT.data.aggregate}}\n{%endif%}",
                "phishtank_reputation": "{%if vars.steps.Get_Reputation_from_Phishtank.data.results.in_database%}{{vars.steps.Get_Reputation_from_Phishtank.data.results.in_database}}{%else%}0{%endif%}",
                "alienvault_reputation": "{%if vars.steps.Get_Reputation_from_AlienVault_OTX.data.general.pulse_info.count%}{{vars.steps.Get_Reputation_from_AlienVault_OTX.data.general.pulse_info.count}}{%else%}0{%endif%}",
                "fortiguard_reputation": "{%if vars.steps.Get_URL_Reputation_FortiGuard.data.category%}{%if 'Phishing' in vars.steps.Get_URL_Reputation_FortiGuard.data.category or 'Malicious' in vars.steps.Get_URL_Reputation_FortiGuard.data.category%}10{%else%}0{%endif%}{%else%}0{%endif%}"
              },
              "status": null,
              "left": "700",
              "top": "311",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation from Phishtank",
              "description": null,
              "arguments": {
                "name": "PhishTank",
                "config": "15a9bcc6-9803-477e-b404-baa2fc05b222",
                "params": {
                  "url": "{{vars.indicator_value}}"
                },
                "version": "1.0.0",
                "connector": "phishtank",
                "operation": "url_reputation",
                "ignore_errors": true,
                "operationTitle": "URL Reputation",
                "step_variables": []
              },
              "status": null,
              "left": "372",
              "top": "600",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "ef43495b-295b-45d5-a0a4-c7de88fb5bcf"
            },
            {
              "@type": "WorkflowStep",
              "name": "Bock URL on FortiGate",
              "description": "This step adds the URL to the static web filter on FortiGate",
              "arguments": {
                "name": "Fortinet FortiGate",
                "config": "0adebb44-e36c-4901-9c3f-7daf02d26f30",
                "params": {
                  "url": "{{vars.indicator_value}}"
                },
                "version": "3.0.0",
                "connector": "fortigate-firewall",
                "operation": "block_url",
                "ignore_errors": true,
                "operationTitle": "Block URL",
                "step_variables": []
              },
              "status": null,
              "left": "1808",
              "top": "66",
              "stepType": "/api/3/workflow_step_types/0bfed618-0316-11e7-93ae-92361f002671",
              "uuid": "6d278ba6-1434-4563-b51c-da9e1af029f0"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "a1143c3e-dd47-4420-921b-43f713edac5d",
              "name": "Start -> Configuration",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8",
              "sourceStep": "/api/3/workflow_steps/7617f1b8-30a8-4ea7-a5a5-d2add2ca2a63"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "db4ae3c4-3a66-4984-8da8-e527c2417842",
              "name": "Configuration -> Get Reputation from URLVoid",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/dc6997c4-de74-4086-90d9-9eca21fb53dd",
              "sourceStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8e1deda2-f25c-4199-94f4-23511328c71b",
              "name": "Configuration -> Get Reputation from AlienVault OTX",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ac9b0a48-4ccc-461d-adaf-9c83504064b6",
              "sourceStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "7b812ff9-0b05-4267-932a-fcd7e8be44c4",
              "name": "Configuration -> Get File Reputation from Anomali",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6bb0a28c-1166-40e8-877c-b8078413972d",
              "sourceStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "78c7d4af-d51b-4c80-b749-33f3e1301403",
              "name": "Configuration -> Get Domain Reputation",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a94eb30f-abaf-4a02-acd7-2cbb1f21c0b1",
              "sourceStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "10ccabf8-cdaa-489d-95e7-bdceabd62906",
              "name": "Compute VT Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c",
              "sourceStep": "/api/3/workflow_steps/00846d83-4a15-4b0a-bc0e-bdd76059056d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6fc35a7f-b68d-47a2-bbb6-6fc3eace1114",
              "name": "Compute Anomali Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c",
              "sourceStep": "/api/3/workflow_steps/79c84609-d231-4156-8922-897b7aad3e90"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0f6230df-d526-43a0-8118-df3f4e376638",
              "name": "Compute AV OTX Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c",
              "sourceStep": "/api/3/workflow_steps/e7f804c8-5168-4fb1-a396-2a28ba7432c4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f288cb7e-c5f2-4e25-83a0-df3a0f9ccd18",
              "name": "Compute URLVoid Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c",
              "sourceStep": "/api/3/workflow_steps/4bc0f3cd-dd91-43b2-a63b-8aec1d3a8450"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "78d86e1e-47e0-4825-ae88-282c86c9bdca",
              "name": "Set Good -> Enrichment Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/1e358a84-241f-4d9f-a2c2-a96a2b380ae3",
              "sourceStep": "/api/3/workflow_steps/6a1960f2-bbed-4871-a05a-1ed323c13d33"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5bf7684b-1889-460d-aa69-f4f3f196e187",
              "name": "Set No reputation -> Enrichment Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/1e358a84-241f-4d9f-a2c2-a96a2b380ae3",
              "sourceStep": "/api/3/workflow_steps/837c26a2-420a-4cb0-9ffd-a18276fdbc89"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "36267b6f-832e-47aa-bd95-0d1b19b093bc",
              "name": "Enrichment Summary -> Is Upon Create",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/60f261fe-2b3a-4588-9326-165fa6c1ba04",
              "sourceStep": "/api/3/workflow_steps/1e358a84-241f-4d9f-a2c2-a96a2b380ae3"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8b7dbc61-f0f2-42a5-b2b7-053d1a6bca15",
              "name": "Is Upon Create -> Summary",
              "label": "Referenced",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/baca38d4-5695-449c-988a-ee043fffa907",
              "sourceStep": "/api/3/workflow_steps/60f261fe-2b3a-4588-9326-165fa6c1ba04"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9a5f68e5-3308-40ea-8e90-c1689995cc4e",
              "name": "Is Upon Create -> Update Record",
              "label": "Upon Create",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/dfb9a8ab-7184-4b96-b1d8-fa24ba0840ef",
              "sourceStep": "/api/3/workflow_steps/60f261fe-2b3a-4588-9326-165fa6c1ba04"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "9b18d76b-639b-4194-85d6-d2bd8b3b12ef",
              "name": "Configuration -> Get URL Reputation FortiGuard",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/70d9f873-e4c7-4d6e-82c7-65fc5133933a",
              "sourceStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b75f3089-f5a7-479d-9b32-2b7a031817e5",
              "name": "Compute FortiGuard Summary -> Is Malicious",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c",
              "sourceStep": "/api/3/workflow_steps/8825eb02-1a5f-46b5-b3c7-a60e77186987"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b5e72c44-0440-45a3-aa86-f6d291efa3b9",
              "name": "Is Malicious -> Set No reputation",
              "label": "no reputation",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/837c26a2-420a-4cb0-9ffd-a18276fdbc89",
              "sourceStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2c7deffd-5b46-4b6a-abe3-b241a04c9d7b",
              "name": "Is Malicious -> Set Goodc",
              "label": "is good",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6a1960f2-bbed-4871-a05a-1ed323c13d33",
              "sourceStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4e755e9d-c095-4506-b913-26270faac0d8",
              "name": "Get URL Reputation from VT -> Aggregate Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a",
              "sourceStep": "/api/3/workflow_steps/a94eb30f-abaf-4a02-acd7-2cbb1f21c0b1"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "da092029-48df-4355-9117-f1d5959651cb",
              "name": "Get URL Reputation from Anomali -> Aggregate Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a",
              "sourceStep": "/api/3/workflow_steps/6bb0a28c-1166-40e8-877c-b8078413972d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "eb74bd68-421c-4a82-bbf2-1b97d7135bf9",
              "name": "Get URL Reputation FortiGuard -> Aggregate Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a",
              "sourceStep": "/api/3/workflow_steps/70d9f873-e4c7-4d6e-82c7-65fc5133933a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "d8632782-7084-4d43-bf86-36a115ccf1e8",
              "name": "Get Reputation from AlienVault OTX -> Aggregate Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a",
              "sourceStep": "/api/3/workflow_steps/ac9b0a48-4ccc-461d-adaf-9c83504064b6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "fa6aeb34-32a5-4f45-b16c-8648169dae86",
              "name": "Get Reputation from URLVoid -> Aggregate Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a",
              "sourceStep": "/api/3/workflow_steps/dc6997c4-de74-4086-90d9-9eca21fb53dd"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6f180ef6-52e0-4c59-848b-1e4d98ec1658",
              "name": "Aggregate Results -> Compute VT Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/00846d83-4a15-4b0a-bc0e-bdd76059056d",
              "sourceStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "b8ea6b49-bb5a-404f-bc2f-77d883bc7ed5",
              "name": "Aggregate Results -> Compute Anomali Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/79c84609-d231-4156-8922-897b7aad3e90",
              "sourceStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "e07eba7d-b036-47f0-bdcd-211355943fc8",
              "name": "Aggregate Results -> Compute FortiGuard Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/8825eb02-1a5f-46b5-b3c7-a60e77186987",
              "sourceStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "18ae8bd7-d92c-4a73-a8bd-b770b533bfd8",
              "name": "Aggregate Results -> Compute AV OTX Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e7f804c8-5168-4fb1-a396-2a28ba7432c4",
              "sourceStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "61798518-a1b6-4991-8848-29cddb263032",
              "name": "Aggregate Results -> Compute URLVoid Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/4bc0f3cd-dd91-43b2-a63b-8aec1d3a8450",
              "sourceStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "29d5a26b-1f7e-4e56-9228-5b742e3a6d35",
              "name": "Configuration -> Get Reputation from Phishtank",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/ef43495b-295b-45d5-a0a4-c7de88fb5bcf",
              "sourceStep": "/api/3/workflow_steps/fbfbbfe9-a463-41e6-9939-0783795951d8"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "693f69f4-3acc-4edc-8f5b-3c8ff00751ab",
              "name": "Get Reputation from Phishtank -> Aggregate Results",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7ef0bcb6-b6e8-4f6a-8b8a-c3b993a3a61a",
              "sourceStep": "/api/3/workflow_steps/ef43495b-295b-45d5-a0a4-c7de88fb5bcf"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "f843afd8-ce11-4f94-ba61-1db16295e794",
              "name": "Is Malicious -> Set Malicious",
              "label": "is Malicious",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/e4b58964-162d-4c5e-802c-1d1a32b0855d",
              "sourceStep": "/api/3/workflow_steps/9a6f6f21-92d8-4aac-83c2-4caf5e50442c"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "8fe6e96d-735f-4c40-93e0-4927d508080d",
              "name": "Set Malicious -> Quarantine IP on FortiGate",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6d278ba6-1434-4563-b51c-da9e1af029f0",
              "sourceStep": "/api/3/workflow_steps/e4b58964-162d-4c5e-802c-1d1a32b0855d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6a8fc59f-22f6-4383-844b-f0be2d486c2b",
              "name": "Set Malicious -> Enrichment Summary",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/1e358a84-241f-4d9f-a2c2-a96a2b380ae3",
              "sourceStep": "/api/3/workflow_steps/e4b58964-162d-4c5e-802c-1d1a32b0855d"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598465464,
          "uuid": "89e26ecf-0369-46ce-9883-d9ed9fccfb73",
          "recordTags": [
            "Indicators"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "07 - Close False Positive Alerts",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/934d609a-42f9-47a5-9f94-fa105808a399",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Set Source Data",
              "description": null,
              "arguments": {
                "alert_data": "{{(vars.input.records[0]['@id'] + \"?$relationships=true\")|fromIRI}}"
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "dd60ae71-80a3-4864-bacf-64e815dc3187"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "route": "691a0ebc-3bcc-4438-a31d-f1350692f30e",
                "resources": [
                  "alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                  "input": {
                    "records": "{{vars.input.records}}"
                  }
                },
                "displayConditions": {
                  "alerts": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                  }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
              "uuid": "934d609a-42f9-47a5-9f94-fa105808a399"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Indicators",
              "description": null,
              "arguments": {
                "reputation_iris": "[]",
                "linked_indicators_reputation_iris": "{{(vars.alert_data.indicators|json_query('[].reputation'))|unique}}"
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "56044f11-f0d3-4550-a015-01f1cda88ec6"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation for Linked Indicators",
              "description": null,
              "arguments": {
                "__temp0": "{%for reputation in vars.linked_indicators_reputation_iris%}\n{{vars.reputation_iris.append(reputation|fromIRI)}}\n{%endfor%}"
              },
              "status": null,
              "left": "125",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "f5f6c0f4-305b-4c16-b8f7-6a3e95598ae3"
            },
            {
              "@type": "WorkflowStep",
              "name": "Debug",
              "description": null,
              "arguments": {
                "All": "{{vars}}"
              },
              "status": null,
              "left": "125",
              "top": "975",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "d5e81e10-b0c7-4e26-8454-1a548f5111ba"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compile Indicators Reputations",
              "description": null,
              "arguments": {
                "reputation_values": "{{vars.reputation_iris|json_query('[].itemValue')}}"
              },
              "status": null,
              "left": "125",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "93153abe-aaae-49c8-ab9c-2103c8be49af"
            },
            {
              "@type": "WorkflowStep",
              "name": "Close Alerts if False Positive",
              "description": null,
              "arguments": {
                "when": "{{'TBD' not in vars.reputation_values and 'Malicious' not in vars.reputation_values and 'Suspicious' not in vars.reputation_values}}",
                "resource": {
                  "status": {
                    "id": 246,
                    "@id": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Closed",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Closed",
                    "orderIndex": 4
                  },
                  "severity": {
                    "id": 12,
                    "@id": "/api/3/picklists/0d609b08-45e0-469f-8910-41145c0b7c03",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#157DD9",
                    "display": "Minimal",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Minimal",
                    "orderIndex": 0
                  },
                  "closureNotes": "None of the Indicators are malicious or suspicious",
                  "closureReason": {
                    "id": 250,
                    "@id": "/api/3/picklists/2b0112f6-4746-4dab-ada6-a8cd1e675572",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "False Positive",
                    "listName": "/api/3/picklist_names/4ebacea1-88cd-4ea8-9dcc-385bea42cc59",
                    "itemValue": "False Positive",
                    "orderIndex": 2
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "840",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "45b9e70e-4592-4082-a9b7-bf1828d8b88e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Alert Has Indicators",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/56044f11-f0d3-4550-a015-01f1cda88ec6",
                    "condition": "{{ vars.alert_data.indicators | length > 0 }}",
                    "step_name": "Get Linked Indicators"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/a51c873f-a5d3-45a3-aacd-ad93dbd17c6f",
                    "step_name": "Do Nothin"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "6381e056-cdff-4f64-a12e-8322103c074e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Do Nothin",
              "description": null,
              "arguments": {
                "params": [],
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "a51c873f-a5d3-45a3-aacd-ad93dbd17c6f"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "857e109b-ffe4-4cfe-b7ef-c4f951930eae",
              "name": "Start -> Set Source Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/dd60ae71-80a3-4864-bacf-64e815dc3187",
              "sourceStep": "/api/3/workflow_steps/934d609a-42f9-47a5-9f94-fa105808a399"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6df8d7ea-bf98-4d56-b870-2ec05fd52c39",
              "name": "Get Linked Indicators -> Get Reputation for Linked Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f5f6c0f4-305b-4c16-b8f7-6a3e95598ae3",
              "sourceStep": "/api/3/workflow_steps/56044f11-f0d3-4550-a015-01f1cda88ec6"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "631de627-42e0-4c88-93db-e866cd218708",
              "name": "Get Reputation for Linked Indicators -> Compile Indicators Reputations",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/93153abe-aaae-49c8-ab9c-2103c8be49af",
              "sourceStep": "/api/3/workflow_steps/f5f6c0f4-305b-4c16-b8f7-6a3e95598ae3"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "80efaeae-9613-4c6d-9ad0-a1ae03a31341",
              "name": "Compile Indicators Reputations -> Close Alerts if False Positive",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/45b9e70e-4592-4082-a9b7-bf1828d8b88e",
              "sourceStep": "/api/3/workflow_steps/93153abe-aaae-49c8-ab9c-2103c8be49af"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "4af9114a-79ab-4ab7-8a48-7f98445ad90d",
              "name": "Close Alerts if False Positive -> Debug",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d5e81e10-b0c7-4e26-8454-1a548f5111ba",
              "sourceStep": "/api/3/workflow_steps/45b9e70e-4592-4082-a9b7-bf1828d8b88e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "2a897369-789d-4aba-86e3-a630671624be",
              "name": "Set Source Data -> Alert Has Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/6381e056-cdff-4f64-a12e-8322103c074e",
              "sourceStep": "/api/3/workflow_steps/dd60ae71-80a3-4864-bacf-64e815dc3187"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "99b36242-ac11-4d2a-89b3-26ed2d7456d0",
              "name": "Alert Has Indicators -> Get Linked Indicators",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/56044f11-f0d3-4550-a015-01f1cda88ec6",
              "sourceStep": "/api/3/workflow_steps/6381e056-cdff-4f64-a12e-8322103c074e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0d6d87bb-9e39-4fa4-8c80-1b39be1e7dc2",
              "name": "Alert Has Indicators -> Do Nothin",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/a51c873f-a5d3-45a3-aacd-ad93dbd17c6f",
              "sourceStep": "/api/3/workflow_steps/6381e056-cdff-4f64-a12e-8322103c074e"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598467771,
          "uuid": "a681f6e4-7b5f-432f-a2f1-047a07a77ed1",
          "recordTags": [
            "Alerts",
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "04 - Create or Link Assets",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [
            "ip_address",
            "alert_iri"
          ],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/8c7569a9-411d-4c35-b927-5f00c884b551",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "step_variables": {
                  "input": {
                    "params": {
                      "alert_iri": "{{ vars.alert_iri }}",
                      "ip_address": "{{ vars.ip_address }}"
                    }
                  }
                }
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/b348f017-9a94-471f-87f8-ce88b6a7ad62",
              "uuid": "8c7569a9-411d-4c35-b927-5f00c884b551"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Record",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "ip",
                      "value": "{{vars.input.params['ip_address']}}",
                      "operator": "eq",
                      "_operator": "eq"
                    }
                  ],
                  "__selectFields": [
                    "ip",
                    "id"
                  ]
                },
                "module": "assets?$limit=30",
                "checkboxFields": true,
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "7e1a866e-51ba-4c17-ad88-ec6f652737cb"
            },
            {
              "@type": "WorkflowStep",
              "name": "Record Exists",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/5537133c-83b9-4f47-a795-dbef6695581b",
                    "condition": "{{ vars.steps.Find_Record | length > 0 }}",
                    "step_name": "Link Record"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/f4fbb4f9-00cf-4c9d-9024-af2c16dc6fba",
                    "step_name": "Create Record"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "5fa13d0b-4fb1-4596-b1d6-e9e72a0fb9e4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Record",
              "description": null,
              "arguments": {
                "resource": {
                  "ip": "{{vars.input.params['ip_address']}}",
                  "name": "{{vars.input.params['ip_address']}}",
                  "alerts": "{{vars.input.params['alert_iri']}}",
                  "__replace": ""
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/assets",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "f4fbb4f9-00cf-4c9d-9024-af2c16dc6fba"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Record",
              "description": null,
              "arguments": {
                "resource": {
                  "__link": {
                    "assets": "{{vars.steps.Find_Record[0]['@id']}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.params['alert_iri']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "5537133c-83b9-4f47-a795-dbef6695581b"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "27615d67-2906-4b68-88ee-984b49eef007",
              "name": "Start -> Find Record",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/7e1a866e-51ba-4c17-ad88-ec6f652737cb",
              "sourceStep": "/api/3/workflow_steps/8c7569a9-411d-4c35-b927-5f00c884b551"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "131f29c6-efbc-4cb9-af17-c2e7d4999db4",
              "name": "Find Record -> Record Exists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5fa13d0b-4fb1-4596-b1d6-e9e72a0fb9e4",
              "sourceStep": "/api/3/workflow_steps/7e1a866e-51ba-4c17-ad88-ec6f652737cb"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "98db999f-1577-47a0-bb1d-f4e1349b5cdb",
              "name": "Record Exists -> Create Record",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f4fbb4f9-00cf-4c9d-9024-af2c16dc6fba",
              "sourceStep": "/api/3/workflow_steps/5fa13d0b-4fb1-4596-b1d6-e9e72a0fb9e4"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c24d69db-aece-4e57-bb56-fa92ea7e3bb0",
              "name": "Record Exists -> Link Record",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5537133c-83b9-4f47-a795-dbef6695581b",
              "sourceStep": "/api/3/workflow_steps/5fa13d0b-4fb1-4596-b1d6-e9e72a0fb9e4"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598465798,
          "uuid": "e35f1316-a39b-468a-bd12-a5a304119c4b",
          "recordTags": [
            "Subroutine",
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "07 - Close False Positive Alerts - Auto",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/77e439d7-1c35-40fd-9aa5-a0a7088ac45e",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Set Source Data",
              "description": null,
              "arguments": {
                "alert_data": "{{(vars.input.records[0]['@id'] + \"?$relationships=true\")|fromIRI}}"
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "c045b221-5ce1-42f7-9d55-68381b78f6c2"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Linked Indicators",
              "description": null,
              "arguments": {
                "reputation_iris": "[]",
                "linked_indicators_reputation_iris": "{{(vars.alert_data.indicators|json_query('[].reputation'))|unique}}"
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "32a813a8-4b9d-4208-bd6c-03df8da67b90"
            },
            {
              "@type": "WorkflowStep",
              "name": "Get Reputation for Linked Indicators",
              "description": null,
              "arguments": {
                "__temp0": "{%for reputation in vars.linked_indicators_reputation_iris%}\n{{vars.reputation_iris.append(reputation|fromIRI)}}\n{%endfor%}"
              },
              "status": null,
              "left": "125",
              "top": "570",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "16165f44-dbd9-4239-8a91-f198b862edfd"
            },
            {
              "@type": "WorkflowStep",
              "name": "Debug",
              "description": null,
              "arguments": {
                "All": "{{vars}}"
              },
              "status": null,
              "left": "125",
              "top": "975",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "d9c72c88-1253-4bfc-a3bb-a2c58dd3e5fe"
            },
            {
              "@type": "WorkflowStep",
              "name": "Compile Indicators Reputations",
              "description": null,
              "arguments": {
                "reputation_values": "{{vars.reputation_iris|json_query('[].itemValue')}}"
              },
              "status": null,
              "left": "125",
              "top": "705",
              "stepType": "/api/3/workflow_step_types/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
              "uuid": "f8a1ecc7-cdb9-41de-975d-e2f5e012cd5b"
            },
            {
              "@type": "WorkflowStep",
              "name": "Close Alerts if False Positive",
              "description": null,
              "arguments": {
                "when": "{{'TBD' not in vars.reputation_values and 'Malicious' not in vars.reputation_values and 'Suspicious' not in vars.reputation_values}}",
                "resource": {
                  "status": {
                    "id": 246,
                    "@id": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "Closed",
                    "listName": "/api/3/picklist_names/33e964a9-d607-49f2-813c-7ce46141815a",
                    "itemValue": "Closed",
                    "orderIndex": 4
                  },
                  "severity": {
                    "id": 12,
                    "@id": "/api/3/picklists/0d609b08-45e0-469f-8910-41145c0b7c03",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#157DD9",
                    "display": "Minimal",
                    "listName": "/api/3/picklist_names/4e80cba3-032f-48b4-ac03-17e3ec247aac",
                    "itemValue": "Minimal",
                    "orderIndex": 0
                  },
                  "closureNotes": "None of the Indicators are malicious or suspicious",
                  "closureReason": {
                    "id": 250,
                    "@id": "/api/3/picklists/2b0112f6-4746-4dab-ada6-a8cd1e675572",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "False Positive",
                    "listName": "/api/3/picklist_names/4ebacea1-88cd-4ea8-9dcc-385bea42cc59",
                    "itemValue": "False Positive",
                    "orderIndex": 2
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "840",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "3e5e75b1-fd5c-4395-be39-05db6532957d"
            },
            {
              "@type": "WorkflowStep",
              "name": "Alert Has Indicators",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/32a813a8-4b9d-4208-bd6c-03df8da67b90",
                    "condition": "{{ vars.alert_data.indicators | length > 0 }}",
                    "step_name": "Get Linked Indicators"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/50ed84f9-f17a-48e7-a4f3-c4acdd73c5a5",
                    "step_name": "Do Nothin"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "5294388f-4f21-4b5a-bc7e-46eb36f85367"
            },
            {
              "@type": "WorkflowStep",
              "name": "Do Nothin",
              "description": null,
              "arguments": {
                "params": [],
                "version": "3.0.3",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "50ed84f9-f17a-48e7-a4f3-c4acdd73c5a5"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "resource": "alerts",
                "resources": [
                  "alerts"
                ],
                "step_variables": {
                  "input": {
                    "records": [
                      "{{vars.input.records[0]}}"
                    ]
                  }
                },
                "fieldbasedtrigger": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "object",
                      "field": "state",
                      "value": "/api/3/picklists/89dc3716-1818-4286-ab75-0d49714aea0f",
                      "_value": {
                        "@id": "/api/3/picklists/89dc3716-1818-4286-ab75-0d49714aea0f",
                        "display": "Similar Alerts Correlated",
                        "itemValue": "Similar Alerts Correlated"
                      },
                      "operator": "eq"
                    },
                    {
                      "type": "object",
                      "field": "status",
                      "value": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                      "_value": {
                        "@id": "/api/3/picklists/fac53e73-8d16-4189-98d5-95fbd1555232",
                        "display": "Closed",
                        "itemValue": "Closed"
                      },
                      "operator": "neq"
                    }
                  ]
                }
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/9300bf69-5063-486d-b3a6-47eb9da24872",
              "uuid": "77e439d7-1c35-40fd-9aa5-a0a7088ac45e"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "82334fa5-1239-4179-8000-f6dc4d7ef082",
              "name": "Get Linked Indicators -> Get Reputation for Linked Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/16165f44-dbd9-4239-8a91-f198b862edfd",
              "sourceStep": "/api/3/workflow_steps/32a813a8-4b9d-4208-bd6c-03df8da67b90"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "a734eb0d-6142-47be-80ae-45f381aadb0d",
              "name": "Get Reputation for Linked Indicators -> Compile Indicators Reputations",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/f8a1ecc7-cdb9-41de-975d-e2f5e012cd5b",
              "sourceStep": "/api/3/workflow_steps/16165f44-dbd9-4239-8a91-f198b862edfd"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "73fc8cc4-cd11-4a2f-9e72-53846e665e9c",
              "name": "Compile Indicators Reputations -> Close Alerts if False Positive",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/3e5e75b1-fd5c-4395-be39-05db6532957d",
              "sourceStep": "/api/3/workflow_steps/f8a1ecc7-cdb9-41de-975d-e2f5e012cd5b"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "0c4a331e-ab12-48d4-b3fc-b29320991ad7",
              "name": "Close Alerts if False Positive -> Debug",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/d9c72c88-1253-4bfc-a3bb-a2c58dd3e5fe",
              "sourceStep": "/api/3/workflow_steps/3e5e75b1-fd5c-4395-be39-05db6532957d"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "c6bddca7-b30e-4229-b95d-22723efbd0c4",
              "name": "Set Source Data -> Alert Has Indicators",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/5294388f-4f21-4b5a-bc7e-46eb36f85367",
              "sourceStep": "/api/3/workflow_steps/c045b221-5ce1-42f7-9d55-68381b78f6c2"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "6d6d1300-7280-47fd-952b-8117af89693d",
              "name": "Alert Has Indicators -> Get Linked Indicators",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/32a813a8-4b9d-4208-bd6c-03df8da67b90",
              "sourceStep": "/api/3/workflow_steps/5294388f-4f21-4b5a-bc7e-46eb36f85367"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "78a99596-3a8a-4fb6-876d-b9c48472b730",
              "name": "Alert Has Indicators -> Do Nothin",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/50ed84f9-f17a-48e7-a4f3-c4acdd73c5a5",
              "sourceStep": "/api/3/workflow_steps/5294388f-4f21-4b5a-bc7e-46eb36f85367"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "65612b52-2f32-49e3-a1dc-ff818e48e825",
              "name": "Start -> Set Source Data",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/c045b221-5ce1-42f7-9d55-68381b78f6c2",
              "sourceStep": "/api/3/workflow_steps/77e439d7-1c35-40fd-9aa5-a0a7088ac45e"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598467976,
          "uuid": "e3bfa84c-8763-4b4c-b35b-ecb919b36878",
          "recordTags": [
            "Alerts",
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        },
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "05 - Create or Link Indicators",
          "aliasName": null,
          "description": null,
          "collection": "/api/3/workflow_collections/1d78848f-fa26-44b4-8254-29d594d29eb3",
          "tag": null,
          "isActive": true,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [
            "ip_address",
            "alert_iri"
          ],
          "synchronous": false,
          "triggerStep": "/api/3/workflow_steps/94a94ced-19d2-4567-8fbd-9742ef669152",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "step_variables": {
                  "input": {
                    "params": {
                      "alert_iri": "{{ vars.alert_iri }}",
                      "ip_address": "{{ vars.ip_address }}"
                    }
                  }
                }
              },
              "status": null,
              "left": "300",
              "top": "30",
              "stepType": "/api/3/workflow_step_types/b348f017-9a94-471f-87f8-ce88b6a7ad62",
              "uuid": "94a94ced-19d2-4567-8fbd-9742ef669152"
            },
            {
              "@type": "WorkflowStep",
              "name": "Find Record",
              "description": null,
              "arguments": {
                "query": {
                  "sort": [],
                  "limit": 30,
                  "logic": "AND",
                  "filters": [
                    {
                      "type": "primitive",
                      "field": "value",
                      "value": "{{vars.input.params['ip_address']}}",
                      "operator": "eq",
                      "_operator": "eq"
                    },
                    {
                      "type": "object",
                      "field": "typeofindicator",
                      "value": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                      "_value": {
                        "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                        "display": "IP Address",
                        "itemValue": "IP Address"
                      },
                      "operator": "eq"
                    }
                  ],
                  "__selectFields": [
                    "value"
                  ]
                },
                "module": "indicators?$limit=30",
                "checkboxFields": true,
                "step_variables": []
              },
              "status": null,
              "left": "300",
              "top": "165",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928770",
              "uuid": "353d2f8b-006c-42d9-9e49-e1dd543ee02e"
            },
            {
              "@type": "WorkflowStep",
              "name": "Record Exists",
              "description": null,
              "arguments": {
                "conditions": [
                  {
                    "option": "yes",
                    "step_iri": "/api/3/workflow_steps/2b366f9b-f8b1-4ab3-ace3-7752ff7d2194",
                    "condition": "{{ vars.steps.Find_Record | length > 0 }}",
                    "step_name": "Link Record"
                  },
                  {
                    "option": "no",
                    "default": true,
                    "step_iri": "/api/3/workflow_steps/fc96678a-3514-41b2-82e0-61597d2229d4",
                    "step_name": "Create Record"
                  }
                ]
              },
              "status": null,
              "left": "300",
              "top": "300",
              "stepType": "/api/3/workflow_step_types/12254cf5-5db7-4b1a-8cb1-3af081924b28",
              "uuid": "26517760-bb6c-4913-8799-33d7cee93e23"
            },
            {
              "@type": "WorkflowStep",
              "name": "Create Record",
              "description": null,
              "arguments": {
                "resource": {
                  "value": "{{vars.input.params['ip_address']}}",
                  "alerts": "{{vars.input.params['alert_iri']}}",
                  "sources": "FortiSIEM",
                  "lastSeen": "{{globalVars.Current_Date}}",
                  "__replace": "",
                  "recordTags": [
                    "/api/3/tags/FortiSIEM"
                  ],
                  "reputation": {
                    "id": 171,
                    "@id": "/api/3/picklists/ae98ebc6-beef-4882-9980-1d88fc6d87cd",
                    "icon": null,
                    "@type": "Picklist",
                    "color": "#696969",
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e75ed3c3-9f23-4a43-832b-0daf236209ba",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "indicatorStatus": {
                    "id": 369,
                    "@id": "/api/3/picklists/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "TBD",
                    "listName": "/api/3/picklist_names/e6639d57-94a9-432f-a46f-b2b530402077",
                    "itemValue": "TBD",
                    "orderIndex": 3
                  },
                  "typeofindicator": {
                    "id": 77,
                    "@id": "/api/3/picklists/c0beeda4-2c7a-4214-b7e5-53ba1649539c",
                    "icon": null,
                    "@type": "Picklist",
                    "color": null,
                    "display": "IP Address",
                    "listName": "/api/3/picklist_names/50ee5bfa-e18f-49ba-8af9-dcca25b0f9c0",
                    "itemValue": "IP Address",
                    "orderIndex": 7
                  }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "/api/3/indicators",
                "fieldOperation": {
                  "recordTags": "Overwrite"
                },
                "step_variables": []
              },
              "status": null,
              "left": "125",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/2597053c-e718-44b4-8394-4d40fe26d357",
              "uuid": "fc96678a-3514-41b2-82e0-61597d2229d4"
            },
            {
              "@type": "WorkflowStep",
              "name": "Link Record",
              "description": null,
              "arguments": {
                "resource": {
                  "__link": {
                    "indicators": "{{vars.steps.Find_Record[0]['@id']}}"
                  }
                },
                "_showJson": false,
                "operation": "Append",
                "collection": "{{vars.input.params['alert_iri']}}",
                "collectionType": "/api/3/alerts",
                "fieldOperation": {
                  "recordTags": "Append"
                },
                "step_variables": []
              },
              "status": null,
              "left": "475",
              "top": "435",
              "stepType": "/api/3/workflow_step_types/b593663d-7d13-40ce-a3a3-96dece928722",
              "uuid": "2b366f9b-f8b1-4ab3-ace3-7752ff7d2194"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "uuid": "322b2e5f-3aef-4556-821f-cde89b2c9cf0",
              "name": "Start -> Find Record",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/353d2f8b-006c-42d9-9e49-e1dd543ee02e",
              "sourceStep": "/api/3/workflow_steps/94a94ced-19d2-4567-8fbd-9742ef669152"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "5ff48937-e8dc-48b3-8bbf-b101888495f6",
              "name": "Find Record -> Record Exists",
              "label": null,
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/26517760-bb6c-4913-8799-33d7cee93e23",
              "sourceStep": "/api/3/workflow_steps/353d2f8b-006c-42d9-9e49-e1dd543ee02e"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "3550dced-85f5-4bd8-89a6-1051bbc33c57",
              "name": "Record Exists -> Create Record",
              "label": "no",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/fc96678a-3514-41b2-82e0-61597d2229d4",
              "sourceStep": "/api/3/workflow_steps/26517760-bb6c-4913-8799-33d7cee93e23"
            },
            {
              "@type": "WorkflowRoute",
              "uuid": "43ee9227-40bc-4850-8669-35d40cd87582",
              "name": "Record Exists -> Link Record",
              "label": "yes",
              "isExecuted": false,
              "targetStep": "/api/3/workflow_steps/2b366f9b-f8b1-4ab3-ace3-7752ff7d2194",
              "sourceStep": "/api/3/workflow_steps/26517760-bb6c-4913-8799-33d7cee93e23"
            }
          ],
          "versions": null,
          "lastModifyDate": 1598465810,
          "uuid": "fab56481-9bfd-42ae-9df9-42a012ad8687",
          "recordTags": [
            "Subroutine",
            "FortiSIEM"
          ],
          "isPrivate": false,
          "owners": []
        }
      ]
    }
  ],
  "macros": [
    {
      "name": "Current_Date",
      "value": "{{arrow.utcnow().timestamp}}",
      "default_value": null
    },
    {
      "name": "Tomorrow_Date",
      "value": "{{arrow.utcnow().shift(hours=+24).timestamp}}",
      "default_value": null
    },
    {
      "name": "Current_Data",
      "value": "{{vars.input.records[0]}}",
      "default_value": null
    }
  ],
  "exported_tags": [
    "FortiSIEM",
    "Indicator",
    "Indicators",
    "Subroutine",
    "Alerts"
  ]
}